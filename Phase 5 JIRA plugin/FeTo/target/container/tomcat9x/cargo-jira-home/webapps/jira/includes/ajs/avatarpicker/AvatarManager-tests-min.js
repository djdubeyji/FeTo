AJS.test.require(["jira.webresources:avatar-picker"],(function(){"use strict";var a=require("jquery"),e=require("jira/ajs/avatarpicker/avatar-manager"),t=require("jira/ajs/avatarpicker/avatar-store"),r=require("jira/ajs/avatarpicker/avatar-factory"),s=require("jira/ajs/avatarpicker/avatar/sizes"),d=require("jira/ajs/avatarpicker/avatar");function i(){var a=new t({restQueryUrl:"blah",restCreateTempUrl:"blah",restUpdateTempUrl:"blah",defaultAvatarId:1e3});return new e({store:a,defaultAvatarId:1e3,avatarSrcBaseUrl:"/secure/projectavatar"})}function u(e){var t=a.ajax;a.ajax=function(r){r.success&&r.success(e,"success",{status:200});r.complete&&r.complete("success",{status:200});a.ajax=t}}test("getById",(function(){var a=i();equal(a.getById(1e3),void 0,"Expected undefined if no match");u({id:1e3});a.add(r.createCustomAvatar({id:1e3}));var e=a.getById(1e3);ok(e instanceof d,"Expected instance of JIRA.Avatar");equal(e.getId(),1e3,"Expected avatar to have id [1000]")}));test("destroy",(function(){var e=i();u({id:1e3});e.add(r.createCustomAvatar({id:1e3}));var t,s,v=e.getById(1e3);u({id:1e3});e.destroy(v);equal(e.getById(1e3),void 0,"Expected avatar to be destroyed");u({id:1e3});e.add(r.createCustomAvatar({id:1e3}));v=e.getById(1e3);s=a.ajax,a.ajax=function(e){e.error&&e.error({status:t||500},"error");e.complete&&e.complete("error",{status:t||500});a.ajax=s};e.destroy(v);ok(e.getById(1e3)instanceof d,"Expected avatar to not be detroyed in case of server error")}));test("getAllSystemAvatars",(function(){var a=i();u({id:1001});a.add(r.createSystemAvatar({id:1001}));u({id:1002});a.add(r.createSystemAvatar({id:1002}));u({id:1003});a.add(r.createSystemAvatar({id:1003}));u({id:1004});a.add(r.createSystemAvatar({id:1004}));u({id:1005});a.add(r.createCustomAvatar({id:1005}));var e=a.getAllSystemAvatars();equal(e[0].getId(),1001);equal(e[1].getId(),1002);equal(e[2].getId(),1003);equal(e[3].getId(),1004);equal(e[4],void 0)}));test("getAllCustomAvatars",(function(){var a=i();u({id:1001});a.add(r.createCustomAvatar({id:1001}));u({id:1002});a.add(r.createCustomAvatar({id:1002}));u({id:1003});a.add(r.createCustomAvatar({id:1003}));u({id:1004});a.add(r.createCustomAvatar({id:1004}));u({id:1005});a.add(r.createSystemAvatar({id:1005}));var e=a.getAllCustomAvatars();equal(e[0].getId(),1001);equal(e[1].getId(),1002);equal(e[2].getId(),1003);equal(e[3].getId(),1004);equal(e[4],void 0)}));test("getAllAvatars",(function(){var a=i();u({id:1001});a.add(r.createCustomAvatar({id:1001}));u({id:1002});a.add(r.createSystemAvatar({id:1002}));var e=a.getAllAvatars();equal(e.custom.length,1);equal(e.system.length,1);equal(e.custom[0].getId(),1001);equal(e.system[0].getId(),1002)}));test("refreshStore",(function(){var a=i();function e(){u({system:[{id:1e3,isSystemAvatar:!0},{id:1001,isSystemAvatar:!0},{id:1002,isSystemAvatar:!0}],custom:[{id:1003},{id:1004}]});a.refreshStore()}e();var t=a.getAllSystemAvatars(),r=a.getAllCustomAvatars();equal(t.length,3);equal(t[0].getId(),1e3);equal(t[1].getId(),1001);equal(t[2].getId(),1002);equal(r.length,2);equal(r[0].getId(),1003);equal(r[1].getId(),1004);e();t=a.getAllSystemAvatars();r=a.getAllCustomAvatars();equal(t.length,3);equal(r.length,2)}));test("getAvatarSrc",(function(){var a={"16x16":"http://localhost:8090/jira/secure/useravatar?size=xsmall&avatarId=10041","24x24":"http://localhost:8090/jira/secure/useravatar?size=small&avatarId=10041","32x32":"http://localhost:8090/jira/secure/useravatar?size=medium&avatarId=10041","48x48":"http://localhost:8090/jira/secure/useravatar?avatarId=10041"},e=i(),t=r.createSystemAvatar({id:1002,urls:a}),d=r.createSystemAvatar({id:999,urls:a});equal(e.getAvatarSrc(t,s.SMALL),a["16x16"]);equal(e.getAvatarSrc(d,s.MEDIUM),a["32x32"]);equal(e.getAvatarSrc(d,s.LARGE),a["48x48"])}))}));