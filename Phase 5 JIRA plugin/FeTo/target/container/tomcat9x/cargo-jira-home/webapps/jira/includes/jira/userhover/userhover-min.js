define("jira/userhover/userhover",["jira/ajs/dropdown/dropdown-factory","aui/inline-dialog","wrm/context-path","jquery","jira/util/assistive","jira/util/formatter"],(function(e,i,t,o,a,n){"use strict";var r=t(),s=function(){},l=400,u="AJS.InlineDialog",d="AJS.InlineDialog.hasUserAttention",c="AJS.InlineDialog.delayId",f="AJS.InlineDialog.isFetchingContent",g="AJS.InlineDialog.focusHandler";s._isLocked=!1;s.INLINE_DIALOG_OPTIONS={urlPrefix:r+"/secure/ViewUserHover!default.jspa?decorator=none&username=",showDelay:l,closeOthers:!1,offsetX:-10,addActiveClass:!1,noBind:!0,hideCallback:function(){var e=this.popup.getOptions();s.hide(e.trigger,e.isHoverLogicDisabled)}};s._showDialog=function(e,t,a){var n={};if(a){var r={isHoverLogicDisabled:!0,shouldFocusTriggerOnClose:!0,showDelay:t?0:s.INLINE_DIALOG_OPTIONS.showDelay};n=Object.assign(s.INLINE_DIALOG_OPTIONS,r)}n.trigger=e;var l="user-hover-dialog-"+(new Date).getTime(),d=new i(o(e),l,(function(i,t,o){s._fetchDialogContents(i,e,o,l,a)}),n);o.data(e,u,d).show()};s.show=function(e,i,t){clearTimeout(o.data(e,c)||0);o.data(e,d,!0);o.data(e,u)||s._isLocked||""===AJS.params.loggedInUser||(i?s._showDialog(e,i,t):o.data(e,c,setTimeout((function(){s._showDialog(e,!1,t)}),l)))};s._hideDialog=function(e,i){i.getOptions().shouldFocusTriggerOnClose&&setTimeout((function(){o(e).focus()}));i.remove();var t=o.data(e,g);o.data(e,g,null);document.removeEventListener("keydown",t);o.data(e,u,null)};s.hide=function(e,i){if(!o.data(e,f)&&!s._isLocked){clearTimeout(o.data(e,c)||0);o.data(e,d,!1);var t=o.data(e,u);t&&(i?s._hideDialog(e,t):o.data(e,c,setTimeout((function(){s._hideDialog(e,t)}),l)))}};s.toggle=function(e,i){o.data(e,u)?s.hide(e,i):s.show(e,i,!0)};s._setupDialogContents=function(i,t,r){i.html(t);var l=o("<button class='aui-button aui-button-text aui-button-close user-hover-close'><span class='aui-icon aui-icon-small aui-iconfont-close-dialog'></span></button>");l.attr("aria-label",n.I18n.getText("common.words.close"));l.on("click keydown",(function(e){a.handleClickSpaceEnter(e,(function(){s.hide(r,!0)}))}));i.append(l);i.css({overflow:"visible",position:"relative"});i.parent().attr({role:"dialog","aria-label":n.I18n.getText("user.hover.tooltip.aria.label")});var u=e.createDropdown({trigger:i.find(".aui-dd-link"),content:i.find(".aui-list")});o(u).bind({showLayer:function(){s._isLocked=!0},hideLayer:function(){s._isLocked=!1;o.data(r,d)||s.hide(r)}})};s._fetchDialogContents=function(e,i,t,a,n){var r=s.INLINE_DIALOG_OPTIONS.urlPrefix+encodeURIComponent(i.getAttribute("rel"));o.data(i,f,!0);o.get(r,(function(r){if(o.data(i,d)){s._setupDialogContents(e,r,i);o.data(i,f,!1);t();var u=function(e){return function(i){if("Tab"===i.key){var t=document.activeElement,a=o("#inline-dialog-"+e).find(":focusable:visible:not([tabindex='-1'])"),n=a[0],r=a[a.length-1];if(i.shiftKey&&t===n){r.focus();i.preventDefault()}else if(!i.shiftKey&&t===r){n.focus();i.preventDefault()}}}}(a);document.addEventListener("keydown",u);o.data(i,g,u);n?setTimeout((function(){e.find("#avatar-image-link").focus()})):o.data(i,c,setTimeout((function(){e.bind({mousemove:function(){s.show(i)},mouseleave:function(){s.hide(i)}})}),l))}else o.data(i,f,!1)}))};return s}));AJS.namespace("jira.app.userhover",null,require("jira/userhover/userhover"));AJS.namespace("JIRA.userhover",null,require("jira/userhover/userhover"));