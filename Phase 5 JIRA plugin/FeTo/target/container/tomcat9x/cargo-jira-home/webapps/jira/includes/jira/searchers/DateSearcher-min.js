define("jira/searchers/datesearcher/date-types",["require"],(function(e){"use strict";var t=e("jquery"),a=e("jira/backbone-1.3.3"),r=e("underscore"),n=e("jira/libs/calendar"),i=["js-dp-type-toggle","js-val","js-measurement","js-clause","js-start-date","js-end-date","js-start-range","js-end-range","assistive"],s=function(e){var a=e.radioKey+"Radio",r=e.$el.html(function(e,a){var r=t("<div></div>").html(e).contents(),n=[];r.each((function(e,r){var s=t(r),d=t("<div/>").html(r).html();if(s.attr("class")&&!i.some((function(e){return s.attr("class").split(" ").includes(e)}))){d=d.replace(/^\s+|\s+$/g,"&nbsp;");n.push("<label for='"+a+"'>"+d+"</label>")}else n.push(d)}));return n.join("")}(e.rawTemplate,a));r.find(":not(.js-dp-type-toggle):not(select):input").mousedown((function(){var e=r.find("label");e.length>0&&e[0].click()}));return r},d=a.View.extend({className:"field-group",attributes:{"data-date-type":"nowOverdue"},template:JIRA.Templates.DateSearcher.nowOverdue,getValues:function(){return{to:0}},updateFromValues:function(e){if(!e.from&&"0"===e.to)return!0},render:function(){return this.$el.html(this.template())}}),l=a.View.extend({className:"field-group",attributes:{"data-date-type":"withinTheLast"},template:JIRA.Templates.DateSearcher.withinTheLast,getValues:function(){var e=this.$(".js-val").val();if(e)return{from:"-"+e+this.$el.find(".js-measurement").val()}},updateFromValues:function(e){if(!e.to&&e.from&&"-"===e.from.charAt(0)){var t=this.model.parseRelativeStr(e.from);this.$(".js-val").val(t.val.slice(1));t.measurement&&this.$(".js-measurement").val(t.measurement);return!0}},render:function(){return s({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}}),o=a.View.extend({className:"field-group",attributes:{"data-date-type":"moreThan"},template:JIRA.Templates.DateSearcher.moreThan,getValues:function(){var e=this.$(".js-val").val();if(e)return{to:"-"+e+this.$el.find(".js-measurement").val()}},updateFromValues:function(e){if(!e.from&&e.to&&"-"===e.to.charAt(0)){var t=this.model.parseRelativeStr(e.to);this.$(".js-val").val(t.val.slice(1));t.measurement&&this.$(".js-measurement").val(t.measurement);return!0}},render:function(){return s({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}}),u=o.extend({className:"field-group",template:JIRA.Templates.DateSearcher.dueMoreThan}),h=a.View.extend({className:"field-group",attributes:{"data-date-type":"dueInNext"},template:JIRA.Templates.DateSearcher.dueInNext,getValues:function(){var e=this.$el.find(".js-val").val();if(e)return{from:"andNot"===this.$el.find(".js-clause").val()?"0":null,to:e+this.$(".js-measurement").val()}},updateFromValues:function(e){if((!e.from||"0"===e.from)&&e.to){var t=this.model.parseRelativeStr(e.to),a="0"===e.from?"andNot":"orIs";this.$(".js-val").val(t.val);this.$(".js-clause").val(a);t.measurement&&this.$(".js-measurement").val(t.measurement);return!0}},render:function(){return s({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}});return{DatesBetween:a.View.extend({className:"field-group",attributes:{"data-date-type":"dateBetween"},template:JIRA.Templates.DateSearcher.dateBetween,getValues:function(){return{startDate:this.$el.find(".js-start-date").val(),endDate:this.$el.find(".js-end-date").val()}},updateFromValues:function(e){if(e.startDate||e.endDate){this.$el.find(".js-start-date").val(e.startDate);this.$el.find(".js-end-date").val(e.endDate);return!0}},bindCalendar:function(e,t){var a=this.$el.find("."+t)[0],i=this.$el.find("."+e)[0],s=r.extend({},this.model.calendarConfig,{inputField:i,button:a});n.setup(s)},render:function(){s({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]});this.bindCalendar("js-end-date","js-end-date-trigger");this.bindCalendar("js-start-date","js-start-date-trigger");return this.$el}}),DueInNext:h,DueMoreThan:u,InRange:a.View.extend({className:"field-group",attributes:{"data-date-type":"inRange"},template:JIRA.Templates.DateSearcher.inRange,getValues:function(){return{from:this.$el.find(".js-start-range").val(),to:this.$el.find(".js-end-range").val()}},updateFromValues:function(e){if(e.from||e.to){this.$el.find(".js-start-range").val(e.from);this.$el.find(".js-end-range").val(e.to);return!0}},render:function(){return s({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}}),MoreThan:o,NowOverdue:d,WithinTheLast:l}}));define("jira/searchers/datesearcher/date-searcher-model",["require"],(function(e){"use strict";var t=e("jira/data/parse-options-from-fieldset");return e("jira/backbone-1.3.3").Model.extend({initialize:function(e){this.from$El=e.$el.find(".js-date-picker-from").hide();this.to$El=e.$el.find(".js-date-picker-to").hide();this.startDate$El=e.$el.find(".js-date-picker-start-date").hide();this.endDate$El=e.$el.find(".js-date-picker-end-date").hide();this.errors=t(e.$el.find("fieldset.js-date-picker-errors"));this.calendarConfig=t(e.$el.find("fieldset.datepicker-params"))},parseRelativeStr:function(e){var t=e.slice(e.length-1);return{val:e.slice(0,e.length-1),measurement:t}},update:function(e){this.clear();if(e){void 0!==e.from&&this.from$El.val(e.from);void 0!==e.to&&this.to$El.val(e.to);void 0!==e.startDate&&this.startDate$El.val(e.startDate);void 0!==e.endDate&&this.endDate$El.val(e.endDate)}},toJSON:function(){return{from:this.from$El.val(),to:this.to$El.val(),startDate:this.startDate$El.val(),endDate:this.endDate$El.val(),errors:this.errors}},clear:function(){this.from$El.val("");this.to$El.val("");this.startDate$El.val("");this.endDate$El.val("")}})}));define("jira/searchers/datesearcher/date-searcher",["require"],(function(e){"use strict";var t=e("jira/searchers/datesearcher/date-searcher-model"),a=e("jquery"),r=e("jira/backbone-1.3.3"),n=e("underscore");return r.View.extend({initialize:function(e){var r=this;this.verb=e.verb;this.model=new t({$el:this.$el});this.setElement(a("<div />").addClass("js-picker-ui").appendTo(this.$el));this.views=[];var i=!a.browser.msie||parseInt(a.browser.version,10)<10;n.each(e.dateTypes,(function(e){var t=new e({model:r.model});r.views.push(t);if(i)t.$el.delegate(":text","input",(function(){r.update(t)}));else{t.$el.delegate(":text","keydown",(function(){var e=a(this),n=e.val();e.one("keyup",(function(){e.val()!==n&&r.update(t)}))}));t.$el.delegate(":text","change",(function(){r.update(t)}))}t.$el.delegate(":radio,select,input","change",(function(){r.update(t)})).delegate(".aui-iconfont-calendar","click",(function(){r.update(t)}))}))},update:function(e){this.model.update(e.getValues());n.each(this.views,(function(t){t===e?t.$(":radio").prop("checked",!0):t.$(":radio").prop("checked",!1)}))},_renderErrors:function(e,t){var r=t.$el.data("date-type"),n=void 0,i=void 0;a.each(e,(function(e,s){if(!i){n=(r||e)+"-error";i=a("<div class='error' />").attr("id",n).text(s)}var d=e.split(":")[1];if(d){t.$el.find("[data-field-name='"+d+"']").attr({"aria-invalid":!0,"aria-describedby":n})}else i.attr("role","alert");return!0}));i.appendTo(t.$el)},render:function(){var e=this,t=this.model.toJSON();n.each(this.views,(function(t){e.$el.append(t.render(e.verb))}));a.each(this.views,(function(a,r){if(this.updateFromValues(t)){e.update(this);n.isEmpty(t.errors)||e._renderErrors(t.errors,r);return!1}}));setTimeout((function(){var t=e.$el.find("[aria-invalid='true']").first();t.length?t.focus():e.$el.find(":radio:checked").focus()}))}})}));define("jira/searchers/datesearcher/date-searcher-factory",["require","exports"],(function(e,t){"use strict";var a=e("jira/searchers/datesearcher/date-types"),r=e("jira/searchers/datesearcher/date-searcher");t.createDueDateSearcher=function(e){return new r({el:e,dateTypes:[a.NowOverdue,a.DueMoreThan,a.DueInNext,a.DatesBetween,a.InRange]}).render()};t.createResolvedDateSearcher=function(e){return new r({el:e,dateTypes:[a.WithinTheLast,a.MoreThan,a.DatesBetween,a.InRange]}).render()};t.createCreatedDateSearcher=function(e){return new r({el:e,dateTypes:[a.WithinTheLast,a.MoreThan,a.DatesBetween,a.InRange]}).render()};t.createUpdatedDateSearcher=function(e){return new r({el:e,dateTypes:[a.WithinTheLast,a.MoreThan,a.DatesBetween,a.InRange]}).render()};t.createCustomDateSearcher=function(e){return new r({el:e,dateTypes:[a.WithinTheLast,a.MoreThan,a.DatesBetween,a.InRange]}).render()}}));