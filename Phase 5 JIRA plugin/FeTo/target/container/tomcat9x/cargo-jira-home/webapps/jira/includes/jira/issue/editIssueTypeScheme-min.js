require(["jira/analytics","jira/dialog/form-dialog","aui/params","underscore","jquery","jira/util/logger"],(function(e,t,i,s,n,a){"use strict";var o=[{selector:"#issue-type-scheme-name",name:"schemeName"},{selector:"#issue-type-scheme-description",name:"schemeDescription"},{selector:"input[name='fieldId']",name:"fieldId"},{selector:"input[name='schemeId']",name:"schemeId"},{selector:"input[name='projectId']",name:"projectId"},{selector:"#default-issue-type-select",name:"defaultOption"}],c=void 0,l=function(){var e=n("#selectedOptions").sortable("serialize",{key:"selectedOptions"});return""===e?"selectedOptions=":e},d=function(){for(var e="AddNewIssueTypeToScheme!input.jspa?"+l(),t={},i=0;i<o.length;i++){var s=n(o[i].selector);t[o[i].name]=s.val()}e=e+"&"+n.param(t);n("#add-new-issue-type-to-scheme").attr("href",e)},r=function(){var e=l().replace(/selectedOptions=/g,"").split("&"),t=document.getElementById("default-issue-type-select");n.each(t.options,(function(i,s){if(""===s.value||n.inArray(s.value,e)>-1)n(s).css({display:"",color:"#000",textDecoration:"none"}).removeAttr("disabled");else{if(s.selected){s.selected=!1;t.options[0].selected=!0}n(s).css({display:"none",color:"#ffcccc",textDecoration:"line-through"}).attr("disabled","disabled")}}));d()},u=function(e,t){n("#"+e).find("li").appendTo(document.getElementById(t));r()},p=function(t){s.isUndefined(c)&&((c=n("input[name=schemeId]").val())||(c=!1));c&&e.send({name:"administration.issuetypeschemes.issuetype."+t+".global"})};n((function(){n("#selectedOptionsRemoveAll").click((function(e){u("selectedOptions","availableOptions");e.preventDefault()}));n("#selectedOptionsAddAll").click((function(e){u("availableOptions","selectedOptions");e.preventDefault()}));n("#selectedOptions").sortable({opacity:.7,connectWith:[document.getElementById("availableOptions")],update:function(e,t){t.sender||"availableOptions"===t.item.parent()[0].id||p("reordered")},receive:function(){p("added")},remove:function(){p("removed")}});i.allowEditOptions&&n("#availableOptions").sortable({update:r,opacity:.7,connectWith:[document.getElementById("selectedOptions")]});n("#submitSave").click((function(){!function(e){e.form.action="ConfigureOptionSchemes.jspa?"+l()}(this)}));n("#submitReset").click((function(e){if(i.resetUrl){n(this).removeDirtyWarning();window.location=i.resetUrl}e.preventDefault()}));n("#issue-type-scheme-name, #issue-type-scheme-description, #default-issue-type-select").change(d);new t({trigger:"#add-new-issue-type-to-scheme",id:"add-new-issue-type-to-scheme-dialog",ajaxOptions:{data:{decorator:"dialog",inline:"true"}},onSuccessfulSubmit:function(t){var i=n("<div>").html(t).find("#add-issue-type-template");i.find("li").appendTo("#selectedOptions");var s=i.find("select");if(s.length>0){n("#default-issue-type-select").unbind().replaceWith(s);s.attr("id","default-issue-type-select").change(d)}r();e.send({name:"administration.issuetypeschemes.issuetype.created.global"})},onDialogFinished:function(){this.hide()}});n("#add-new-issue-type-to-scheme").attr("formDialogBound","1");r();a.trace("jira.edit.issuetypescheme.initialized")}))}));