define("jira/ajs/ajax/smart-ajax",["jira/util/formatter","jira/util/logger","jira/util/data/meta","jquery"],(function(t,a,r,e){"use strict";function n(t,r,e){var n=r?"["+r+"] ":" ";a.log("ajax"+n+t+" : "+e)}function s(t,a){try{return t()}catch(t){return a}}var o={SmartAjaxResult:function(t,a,r,e,n,o){var u={successful:n,status:s((function(){return t.status}),0),statusText:r,errorThrown:o,readyState:t.readyState,hasData:null!=e&&e.length>0,data:e,xhr:t,aborted:t.aborted,requestId:a,validationError:!(400!==t.status||!e||!e.errors),toString:function(){return"{\nsuccessful  : "+this.successful+",\nstatus      : "+this.status+",\nstatusText  : "+this.statusText+",\nhasData     : "+this.hasData+",\nreadyState  : "+this.readyState+",\nrequestId   : "+this.requestId+",\naborted     : "+this.aborted+",\n}"}};return u}};o.SmartAjaxResult.ERROR="error";o.SmartAjaxResult.TIMEOUT="timeout";o.SmartAjaxResult.NOTMODIFIED="notmodified";o.SmartAjaxResult.PARSEERROR="parseerror";o.makeRequest=function(t){var a,r,i,c={},m=(a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),i=a.getTime()-r.getTime(),Math.max(Math.floor(i),1)),l=function(a,r,u,i){if(!i){var l=s((function(){return a.responseText}),"");i=c=new o.SmartAjaxResult(a,m,r,l,!1,u)}n("error",i.requestId,i);e.isFunction(t.error)&&t.error(a,r,u,i)},x={jqueryAjaxFn:e.ajax,headers:{"X-AUSERNAME":encodeURIComponent(u())}},j=e.extend(!0,{},x,t);j.error=l;j.success=function(a,r,n){if(n.status<100){c=new o.SmartAjaxResult(n,m,o.SmartAjaxResult.ERROR,"",!1);l(n,o.SmartAjaxResult.ERROR,void 0,c)}else{c=new o.SmartAjaxResult(n,m,r,a,!0);e.isFunction(t.success)&&t.success(a,r,n,c)}};j.complete=function(a,r){e.isFunction(t.complete)&&t.complete(a,r,c)};var d,f=j.jqueryAjaxFn.apply(j,[j]);try{f.abort=(d=f.abort,function(){n("aborted",m,"");f.aborted=!0;if(e.isFunction(d))try{d.apply(f,arguments)}catch(t){}})}catch(t){}return f};o.buildDialogErrorContent=function(a,r){var e=Math.floor(a.status/100);return a.hasData&&4!==e?c(AJS.extractBodyFromResponse(a.data)):function(a,r){var e='<div class="dialog-error"><p>'+a+"</p><p>"+t.I18n.getText("common.forms.ajax.error.dialog")+"</p></div>";r||(e="<h1>"+t.I18n.getText("common.forms.ajax.error.dialog.heading")+"</h1>"+e);return c(e)}(i(a),r)};o.buildSimpleErrorContent=function(t,a){return i(t)};function u(){var t=r.get("remote-user");return void 0===t?"undefined":t}function i(a){return a.statusText===o.SmartAjaxResult.TIMEOUT?t.I18n.getText("common.forms.ajax.timeout"):401===a.status?t.I18n.getText("common.forms.ajax.unauthorised.alert"):a.hasData?t.I18n.getText("common.forms.ajax.servererror"):t.I18n.getText("common.forms.ajax.commserror")}function c(t){var a=e('<div class="ajaxerror"/>');a.append(t);return a}return o}));AJS.namespace("JIRA.SmartAjax",null,require("jira/ajs/ajax/smart-ajax"));AJS.namespace("jira.ajax",null,require("jira/ajs/ajax/smart-ajax"));