AJS.test.require(["jira.webresources:jira-fields","jira.webresources:jira-global"],(function(){"use strict";var e=require("jira/field/user-picker-util");module("JIRA.UserPickerUtil");test("formatResponse returns correct group descriptor",(function(){var r=e.formatResponse([{footer:"label1",users:[{name:"name1",displayName:"Name 1",html:"<html1>",avatarUrl:"/avatar1"},{name:"name2",displayName:"Name 2",html:"<html1>",avatarUrl:"/avatar2"}]}]);equal(r.length,1,"Return only one GroupDescriptor");var t=r[0];equal(t.weight(),0,"GroupDescriptor weight should be 0");equal(t.label(),"label1",'GroupDescriptor label should be "label1"');equal(t.items().length,2,"GroupDescriptor should have 2 ItemDescriptors");var a=t.items()[0];equal(a.label(),"Name 1",'First ItemDescriptor should be "Name 1"');var l=t.items()[1];equal(l.label(),"Name 2",'Second ItemDescriptor should be "Name 2"')}));test("formatResponseWithoutHTML returns correct group descriptor",(function(){var r=e.formatResponseWithoutHTML({users:[{name:"name1",displayName:"Name 1",emailAddress:"email1",avatarUrl:"/avatar1"},{name:"name2",displayName:"Name 2",emailAddress:"email2",avatarUrl:"/avatar2"}]},"Na");equal(r.length,1,"Return only one GroupDescriptor");var t=r[0];equal(t.weight(),0,"GroupDescriptor weight should be 0");equal(t.label(),"","GroupDescriptor label should be empty");equal(t.items().length,2,"GroupDescriptor should have 2 ItemDescriptors");var a=t.items()[0];equal(a.label(),"Name 1",'First ItemDescriptor should be "Name 1"');equal(a.html(),"<mark>Na</mark>me 1 - email1 (<mark>na</mark>me1)","First ItemDescriptor HTML should be correctly formatted");var l=t.items()[1];equal(l.label(),"Name 2",'Second ItemDescriptor should be "Name 2"');equal(l.html(),"<mark>Na</mark>me 2 - email2 (<mark>na</mark>me2)","Second ItemDescriptor HTML should be correctly formatted")}));test("formatResponseWithoutHTML escapes user display name and name",(function(){var r="Nice site,  I think I'll take it. <script>alert('Executing JS')<\/script>",t=e.formatResponseWithoutHTML({users:[{name:"Bob <script>alert('Executing JS')<\/script>",displayName:"Nice site,  I think I'll take it. <script>alert('Executing JS')<\/script>",emailAddress:"email2@qunit.com",avatarUrl:"/avatar2"}]},"site");equal(t.length,1,"Return only one GroupDescriptor");var a=t[0];equal(a.weight(),0,"GroupDescriptor weight should be 0");equal(a.label(),"","GroupDescriptor label should be empty");equal(a.items().length,1,"GroupDescriptor should have 1 ItemDescriptor");var l=a.items()[0];equal(l.label(),r,'First ItemDescriptor should be "'+r+'"');equal(l.html(),"Nice <mark>site</mark>,  I think I&#x27;ll take it. &lt;script&gt;alert(&#x27;Executing JS&#x27;)&lt;/script&gt; - email2@qunit.com (Bob &lt;script&gt;alert(&#x27;Executing JS&#x27;)&lt;/script&gt;)","First ItemDescriptor HTML should be correctly formatted")}));test("getUrl returns correct URL",(function(r){var t=e.getUrl(!0,!1,"");ok(t.includes("/rest/api/1.0/users/picker"),"URL for custom field with feature flag turned off should be correct.");var a=e.getUrl(!1,!1,"");ok(a.includes("/rest/api/2/user/picker"),"URL for non-custom field with feature flag turned off should be correct.");(0,r.throws)((function(){e.getUrl(!1,!0,"unknownPicker")}),"Trying to get URL for unknown picker should throw an error.");var l=e.getUrl(!1,!0,"reporter");ok(l.includes("/rest/internal/2/users/reporter"),"URL for reporter picker with feature flag turned on should be correct.")}))}));