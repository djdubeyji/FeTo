define("jira/ajs/ajax/smart-ajax/web-sudo",["jira/jquery/deferred","jira/ajs/ajax/smart-ajax","jira/ajs/ajax/ajax-util","jira/dialog/dialog","jira/dialog/form-dialog","jira/util/browser","wrm/context-path","jquery"],(function(e,a,t,s,o,i,n,c){"use strict";var u=n();return{showWebSudoDialog:function(e){var t=e.context||this,n=new o({id:"smart-websudo",type:"ajax",ajaxOptions:{url:u+"/secure/admin/WebSudoAuthenticate!default.jspa?close=true"},submitHandler:function(s,o){s.preventDefault();var i=c(s.target);a.makeRequest({url:i.attr("action"),data:i.serialize(),type:"POST",complete:function(a){if("Has-Authentication"===a.getResponseHeader("X-Atlassian-WebSudo"))if(c.isFunction(e.success))e.success.call(t,(function(){o();n.hide()}));else{o();n.hide()}else n._setContent(a.responseText,!0)}})}});c.isFunction(e.cancel)&&c(n).one("Dialog.hide",(function(a,o,n){if(n===s.HIDE_REASON.cancel||n===s.HIDE_REASON.escape){a=c.Event();(!1===e.cancel.call(t,a)||!a.isDefaultPrevented())&&i.reloadViaWindowLocation(o.find(".cancel").attr("href"))}}));c.isFunction(e.beforeShow)&&e.beforeShow.call(t);n.show();c.isFunction(e.show)&&e.show.call(t)},handleWebSudoError:function(e,t,s,o,i){var n={success:function(s){t&&c.isFunction(t.success)?t.success.apply(this,arguments):s();a.makeRequest(e)},cancel:function(){c.isFunction(e.complete)&&e.complete.call(this,s,o,i);t&&c.isFunction(t.cancel)&&t.cancel.apply(this,arguments)},beforeShow:function(){t&&c.isFunction(t.beforeShow)&&t.beforeShow.apply(this,arguments)},show:function(){t&&c.isFunction(t.show)&&t.show.apply(this,arguments)},context:this};this.showWebSudoDialog(n)},makeWebSudoRequest:function(s,o){var i=c.extend({},s),n=!1,u=e(),r=this;i.error=function(e,a,l,d){if(t.isWebSudoFailure(e)){n=!0;r.handleWebSudoError(i,o,e,a,d)}else{u.rejectWith(this,arguments);c.isFunction(s.error)&&s.error.apply(this,arguments)}};i.complete=function(){!n&&c.isFunction(s.complete)&&s.complete.apply(this,arguments);n=!1};i.success=function(){c.isFunction(s.success)&&s.success.apply(this,arguments);u.resolveWith(this,arguments)};a.makeRequest(i);return u.promise()}}}));!function(e){"use strict";AJS.namespace("JIRA.SmartAjax.showWebSudoDialog",null,e.showWebSudoDialog);AJS.namespace("JIRA.SmartAjax.handleWebSudoError",null,e.handleWebSudoError);AJS.namespace("JIRA.SmartAjax.makeWebSudoRequest",null,e.makeWebSudoRequest)}(require("jira/ajs/ajax/smart-ajax/web-sudo"));