define("jira/viewissue/watchers-voters/views/watchers-no-browse-view",["require"],(function(e){"use strict";var t=e("jira/viewissue/watchers-voters/views/abstract-watchers-view"),r=e("jira/util/data/meta"),i=e("underscore"),a=e("jquery"),s=e("jira/util/logger"),n=e("jira/util/formatter"),o=JIRA.Templates.Issue;return t.extend({events:{"click .remove-recipient":"removeWatcher",submit:"addWatcher"},addWatcher:function(e){e.preventDefault();this.removeInlineError();var t=a("#watchers-nosearch"),s=a.trim(t.val());t.attr("disabled","disabled");if(this.hasUsername(s)){t.removeAttr("disabled");this.showInlineError(n.I18n.getText("watching.manage.user.already.watching",s));t.val("")}else this.collection.getUser(s).done(i.bind((function(e){var i=JIRA.Templates.Fields.recipientUsername({icon:e.avatarUrls["16x16"],username:e.name,displayName:e.displayName});s===r.get("remote-user")&&this.watch();t.val("");this.$(".watchers").append(i);this.collection.addWatcher(e.name);this._incrementWatcherCount()}),this)).fail(i.bind((function(e){404===e.status&&this.showInlineError(n.I18n.getText("admin.viewuser.user.does.not.exist.title"))}),this)).always((function(){t.removeAttr("disabled").focus()}))},hasUsername:function(e){var t=!1;this.$(".watchers li").each((function(){if(a(this).attr("data-username")===e){t=!0;return!1}}));return t},removeInlineError:function(){this.$(".error").remove()},showInlineError:function(e){a("<div />").addClass("error").text(e).insertAfter(this.$(".description"))},focus:function(){a("#watchers-nosearch").focus()},removeWatcher:function(e){e.preventDefault();var t=a(e.target).closest("li"),i=t.attr("data-username");if(i){t.remove();this.collection.removeWatcher(i);this._decrementWatcherCount();i===r.get("remote-user")&&this.unwatch()}s.trace("jira.issue.watcher.deleted")},_render:function(){this.$el.html(o.watchersNoBrowse({watchers:this.collection.toJSON()}))}})}));