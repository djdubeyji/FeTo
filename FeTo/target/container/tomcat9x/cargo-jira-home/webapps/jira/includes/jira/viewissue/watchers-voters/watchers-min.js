define("jira/viewissue/watchers-voters/watchers",["require"],(function(e){"use strict";var i=e("jira/viewissue/watchers-voters/views/watchers-read-only-view"),s=e("jira/viewissue/watchers-voters/views/watchers-no-browse-view"),n=e("jira/viewissue/watchers-voters/views/watchers-view"),t=e("jira/viewissue/watchers-voters/entities/watchers-user-collection"),r=e("jira/viewissue/watchers-voters/views/watchers-inline-dialog-view"),o=e("jira/util/events"),a=e("jira/util/events/types"),c=e("jira/util/events/reasons"),l=e("jira/issue"),w=e("aui/inline-dialog"),u=e("jira/util/key-code"),d=e("jquery"),v=null;function h(){v||(v=new r({el:d("#inline-dialog-watchers").get(0)}));return v}d(document).on("click","#view-watcher-list",(function(e){e.preventDefault();var r=h(),o=d("#watching-toggle").next(".icon"),a=new t(l.getIssueKey());o.addClass("loading");var c=function(e){return e.isReadOnly?i:e.canBrowseUsers?n:s}(a);new c({collection:a}).render().done((function(e){o.removeClass("loading");r.contents(e);r.show()}));a.on("errorOccurred",(function(){r.hide()}))}));d(document).on("keydown",(function(e){if(v&&e.keyCode===u.ESCAPE&&w.current!==v.el&&v.isVisible()){w.current&&w.current.hide();v.hide()}}));d(document).on("click",(function(e){if(v){0===d(e.target).closest("#inline-dialog-watchers, #watchers-suggestions").length&&v.isVisible()&&v.hide()}}));o.bind(a.NEW_CONTENT_ADDED,(function(e,i,s){s===c.panelRefreshed&&i.is("#peoplemodule")&&h().setElement(i.find("#inline-dialog-watchers").get(0))}))}));