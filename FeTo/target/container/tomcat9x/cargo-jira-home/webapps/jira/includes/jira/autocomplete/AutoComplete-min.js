define("jira/autocomplete/autocomplete",["jira/ajs/ajax/smart-ajax","jira/util/key-code","jira/util/objects","jira/util/formatter","jquery"],(function(e,t,o,n,i){"use strict";return d={9:!0,13:!0,14:!0,25:!0,27:!0,38:!0,40:!0,224:!0},{dispatcher:function(){},getSavedResponse:function(){},saveResponse:function(){},renderSuggestions:function(){},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},set:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},completeField:function(e){if(e){this.field.val(e).focus();this.field.trigger("change")}},textToSuggestionCursorPosition:function(){return this.field.val()},_makeRequest:function(t){var n=this,i=o.copyObject(t);this.pendingRequest&&this.pendingRequest.abort();i.complete=function(){n.pendingRequest=null};i.error=function(e){!e.aborted&&0!==e.status&&t.error&&t.error.apply(this,arguments)};this.pendingRequest=e.makeRequest(i);return this.pendingRequest},addSuggestionControls:function(e){var o=this,r=function(e){void 0!==o.selectedIndex&&o.selectedIndex>-1&&o.suggestionNodes[o.selectedIndex][0].removeClass("active");o.selectedIndex=function(e,t){var n=!1===o.autoSelectFirst?-1:0;if(o.allowArrowCarousel)return e>t?n:e<n?t:e;if(e>t)return t;if(e<n){o.responseContainer.scrollTop(0);return n}return e}(e,o.suggestionNodes.length-1);o.selectedIndex>-1&&o.suggestionNodes[o.selectedIndex][0].addClass("active")},d=function(){return o.suggestionNodes&&o.suggestionNodes[o.selectedIndex]&&o.suggestionNodes[o.selectedIndex][0].hasClass("active")},a=function(e){var t=e.optionName,i=e.optionIndex,s=e.optionsLength;o.assistiveContainer.text(n.I18n.getText("navigator.advanced.query.selected.option",t,i,s))};if(e.length){this.selectedIndex=0;this.suggestionNodes=e;for(var l=0;l<o.suggestionNodes.length;l++){var u={instance:this,index:l};this.suggestionNodes[l][0].bind("mouseover",u,p).bind("mouseout",u,c).bind("click",u,h).bind("mousedown",(function(e){e.preventDefault()}))}if(!this.keyboardHandlerBinded){i(this.field).keypress((function(e){if(o.responseContainer.is(":visible")&&e.keyCode===t.ENTER){d()&&!o.pendingRequest&&o.completeField(o.suggestionNodes[o.selectedIndex][1]);e.preventDefault();e.stopPropagation()}}));i(this.field).keydown((function(e){if(o.responseContainer.is(":visible")){o.field[0]!==document.activeElement&&o.field.focus();if(e.keyCode===t.DOWN){r(o.selectedIndex+1);if(o.selectedIndex>=0){var n=o.responseContainer.height(),i=o.suggestionNodes[o.selectedIndex][0].position().top+o.suggestionNodes[o.selectedIndex][0].outerHeight();i-n>0&&o.responseContainer.scrollTop(o.responseContainer.scrollTop()+i-n+2);a({optionName:o.suggestionNodes[o.selectedIndex][1],optionIndex:o.selectedIndex+1,optionsLength:o.suggestionNodes.length})}else o.responseContainer.scrollTop(0);e.preventDefault()}else if(e.keyCode===t.UP){r(o.selectedIndex-1);if(o.selectedIndex>=0){var s=o.suggestionNodes[o.selectedIndex][0].position().top;s<0&&o.responseContainer.scrollTop(o.responseContainer.scrollTop()+s-2);a({optionName:o.suggestionNodes[o.selectedIndex][1],optionIndex:o.selectedIndex+1,optionsLength:o.suggestionNodes.length})}e.preventDefault()}else if(e.keyCode===t.TAB)if(d()){o.completeField(o.suggestionNodes[o.selectedIndex][1]);e.preventDefault()}else o.dropdownController.hideDropdown()}}));this.keyboardHandlerBinded=!0}!1===o.autoSelectFirst?r(-1):r(0);s=this}function p(e){o.dropdownController.displayed&&r(e.data.index)}function c(e){0===e.data.index&&(o.selectedIndex=-1);i(this).removeClass("active")}function h(e){o.completeField(o.suggestionNodes[e.data.index][1])}},clearResponseContainer:function(){this.responseContainer.empty();this.suggestionNodes=void 0},delay:r=function e(t,o){if(e.t){clearTimeout(e.t);e.t=void 0}e.t=setTimeout(t,1e3*o)},buildResponseContainer:function(){var e=this.field.parent().addClass("atlassian-autocomplete");this.responseContainer=i(document.createElement("div"));this.responseContainer.addClass("suggestions");this.positionResponseContainer();this.responseContainer.appendTo(e);this.assistiveContainer=i(document.createElement("div"));this.assistiveContainer.attr({role:"status",class:"autocomplete-assistive assistive"});this.assistiveContainer.appendTo(e)},positionResponseContainer:function(){this.responseContainer.css({top:this.field.outerHeight()})},keyUpHandler:function(){function e(){this.responseContainer||this.buildResponseContainer();this.dispatcher(this.field.val())}return function(o){this.field.val().length>=this.minQueryLength&&(o.keyCode in d&&(!this.responseContainer||this.responseContainer.is(":visible")||o.keyCode!==t.UP&&o.keyCode!==t.DOWN)||e.call(this));return o}}(),addMultiSelectAdvice:function(e){var t=this,o=function e(o){if(!e.isAlerting){e.isAlerting=!0;var n=i(document.createElement("div")).css({float:"left",display:"none"}).addClass("warningBox").html("Oops! You have already entered the value <em>"+o+"</em>").appendTo(t.field.parent()).show("fast",(function(){t.delay((function(){n.hide("fast",(function(){n.remove();e.isAlerting=!1}))}),4)}))}};i.aop.before({target:this,method:"dispatcher"},(function(t){var o=this.field.val();t[0]=i.trim(o.slice(o.lastIndexOf(e)+1));return t}));i.aop.before({target:this,method:"completeField"},(function(t){var n=t[0],s=this.field.val().split(e),r=i(s).map((function(){return i.trim(this)})).get();if(!this.allowDuplicates&&new RegExp("(?:^|[\\s"+e+"])"+n+"\\s*"+e).test(this.field.val())){o(n);r[r.length-1]=""}else{r[r.length-1]=n;r[r.length]=""}t[0]=r.join(e.replace(/([^\s]$)/,"$1 "));return t}))},addDropdownAdvice:function(){i.aop.after({target:this,method:"buildResponseContainer"},(function(e){this.dropdownController=JIRA.Dropdown.AutoComplete({target:this,method:"renderSuggestions"},this.responseContainer);i.aop.after({target:this.dropdownController,method:"hideDropdown"},(function(){this.dropdown.removeClass("dropdown-ready");clearTimeout(r.t)}));return e}));i.aop.after({target:this,method:"renderSuggestions"},(function(e){if(e&&e.length>0){this.dropdownController.displayDropdown();this.maxHeight&&this.dropdownController.dropdown.prop("scrollHeight")>this.maxHeight?this.dropdownController.dropdown.css({height:this.maxHeight,overflowX:"visible",overflowY:"scroll"}):this.maxHeight&&this.dropdownController.dropdown.css({height:"",overflowX:"",overflowY:""});this.dropdownController.dropdown.addClass("dropdown-ready")}else this.dropdownController.hideDropdown();return e}));i.aop.after({target:this,method:"completeField"},this._afterCompleteField);i.aop.after({target:this,method:"keyUpHandler"},(function(e){if((!(this.field.val().length>=this.minQueryLength)||e.keyCode===t.ESCAPE)&&this.dropdownController&&this.dropdownController.displayed){this.dropdownController.hideDropdown();e.keyCode===t.ESCAPE&&e.stopPropagation()}return e}))},_afterCompleteField:function(e){this.dropdownController.hideDropdown();return e},init:function(e){var o=this;this.set(e);this.field=this.field||i("#"+this.fieldID);this.field.attr("autocomplete","off").keyup((function(e){o.disabled||o.keyUpHandler(e)})).keydown((function(e){e.keyCode===t.ESCAPE&&o.responseContainer&&o.responseContainer.is(":visible")&&e.preventDefault()})).click((function(){s===o&&setTimeout((function(){o.dispatcher(o.field.val())}),0)})).blur((function(){o.pendingRequest&&o.pendingRequest.abort()})).focus((function(e){o.responseContainer||o.buildResponseContainer();if(!o.disabled){e.originalEvent&&e.originalEvent.relatedTarget&&setTimeout((function(){o.dispatcher(o.field.val())}),0);s=o}}));this.addDropdownAdvice();e.delimChar&&this.addMultiSelectAdvice(e.delimChar)}};var s,r,d}));AJS.namespace("jira.widget.autocomplete",null,require("jira/autocomplete/autocomplete"));AJS.namespace("JIRA.AutoComplete",null,require("jira/autocomplete/autocomplete"));