var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};define("jira/ajs/keyboardshortcut/keyboard-shortcut",["jira/util/formatter","jira/util/key-code","aui/inline-dialog","wrm/context-path","jira/jquery/deferred","jquery","underscore"],(function(t,e,o,r,n,i,c){"use strict";var u=r(),s=function(t,e){this._executer=null;this.shortcuts=[t];this._bindShortcut(t,e)},a=new n;s.prototype._bindShortcut=function(t,e){if("string"!=typeof t)throw new TypeError("KeyboardShortcut expects string; received "+(void 0===t?"undefined":_typeof(t)));if(/^(?:ctrl|alt|shift|meta)+/i.test(t))throw new SyntaxError('KeyboardShortcut cannot bind the shortcut "'+t+'" because it uses a modifier');var r=this;i(document).bind("shortcut",t,(function(n){if(r._executer&&!r._ignoreShortcut(n,t,e)){o.current&&o.current.hide();r._executer(n);n.preventDefault()}}))};s.prototype._ignoreShortcut=function(t,e,o){var r=!1;c.each(s._ignoreConditions,(function(n){n(t,e,o)&&(r=!0)}));return r};s.prototype._addShortcutTitle=function(e){var o=i(e),r=o.attr("title")||"",n=t.I18n.getText("keyboard.shortcuts.type"),c=t.I18n.getText("keyboard.shortcuts.then"),u=t.I18n.getText("keyboard.shortcuts.or"),s=" ( "+n+i.map(this.shortcuts,(function(t){return" '"+t.split("").join("' "+c+" '")+"'"})).join(" "+u+" ")+" )";r.includes(s)||(r+=s);o.attr("title",r)};s.prototype.moveToNextItem=function(t){this._executer=function(){var o,r=i(t),n=i(t+".focused");this._executer.blurHandler||i(document).one("keypress",(function(t){t.keyCode===e.ESCAPE&&n&&n.removeClass("focused")}));if(0===n.length)n=i(t).eq(0);else{n.removeClass("focused");if((o=i.inArray(n.get(0),r))<r.length-1){o+=1;n=r.eq(o)}else{n.removeClass("focused");n=i(t).eq(0)}}if(n&&n.length>0){n.addClass("focused");n.scrollIntoView();n.find("a:first").focus()}}};s.prototype.moveToPrevItem=function(t){this._executer=function(){var o,r=i(t),n=i(t+".focused");this._executer.blurHandler||i(document).one("keypress",(function(t){t.keyCode===e.ESCAPE&&n&&n.removeClass("focused")}));if(0===n.length)n=i(t+":last");else{n.removeClass("focused");if((o=i.inArray(n.get(0),r))>0){o-=1;n=r.eq(o)}else{n.removeClass("focused");n=i(t+":last")}}if(n&&n.length>0){n.addClass("focused");n.scrollIntoView();n.find("a:first").focus()}}};s.prototype.click=function(t){this._addShortcutTitle(t);this._executer=function(){var e=i(t).eq(0);e.length>0&&e.click()}};s.prototype.goTo=function(t){this._executer=function(){window.location.href=u+t}};s.prototype.followLink=function(t){this._addShortcutTitle(t);this._executer=function(){var e=i(t).eq(0);if(e.length>0&&("a"===e.prop("nodeName").toLowerCase()||"link"===e.prop("nodeName").toLowerCase())){e.click();window.location.href=e.attr("href")}}};s.prototype.moveToAndClick=function(t){this._addShortcutTitle(t);this._executer=function(){var e=i(t).eq(0);if(e.length>0){e.click();e.scrollIntoView()}}};s.prototype.moveToAndFocus=function(t){this._addShortcutTitle(t);this._executer=function(e){var o=i(t).eq(0);if(o.length>0){o.focus();o.scrollIntoView();o.is(":input")&&e.preventDefault()}}};s.prototype.evaluate=function(t){"function"!=typeof t&&(t=new Function(t));t.call(this)};s.prototype.execute=function(t){var e=this;this._executer=function(){"function"!=typeof t&&(t=new Function(t));t.call(e)}};s.prototype.or=function(t){this.shortcuts.push(t);this._bindShortcut(t);return this};s._ignoreConditions=[];s._shortcuts=[];Object.defineProperty(s,"initialised",{value:a.promise(),writable:!1,configurable:!1});s.addIgnoreCondition=function(t){s._ignoreConditions.push(t)};s.getKeyboardShortcutKeys=function(t){for(var e in s._shortcuts)if(Object.prototype.hasOwnProperty.call(s._shortcuts,e)){var o=s._shortcuts[e];if(o.moduleKey===t)return o.keys.toString()}return null};s.fromJSON=function(t){var e;if(t){s._shortcuts=t;e={};c.each(t,(function(t){var o=c.flatten(t.keys),r=o.join("");if(o.length<r.length)throw new Error("Shortcut sequence ["+o.join(",")+"] contains invalid keys");(e[r]=new s(r,t.context))[t.op](t.param)}))}a.resolve(s);return e};return s}));AJS.namespace("AJS.KeyboardShortcut",null,require("jira/ajs/keyboardshortcut/keyboard-shortcut"));