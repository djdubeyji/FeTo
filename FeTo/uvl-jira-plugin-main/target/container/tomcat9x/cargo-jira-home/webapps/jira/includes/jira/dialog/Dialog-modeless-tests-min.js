AJS.test.require(["jira.webresources:jira-global","jira.webresources:dialogs","com.atlassian.auiplugin:dialog2"],(function(){"use strict";var t,e,o=require("jquery"),i=require("underscore"),n=require("jira/dialog/dialog"),a=AJS.Dialog,d=AJS.dialog2,s=AJS.dim,u=[],r=function(){for(var t=0;t<arguments.length;t++)arguments[t].show()},l=function(){for(var t=0;t<arguments.length;t++)arguments[t].hide()},c=function(t){return t.options&&t.options.windowTitle||t.get&&t.get("header")&&t.get("header")[0].text()||t.$el&&t.$el.find("header").text()||"n/a"},h=function(t,e){e="modal"!==e;strictEqual(t.isModeless(),!!e,c(t)+" should "+(e?"":"not ")+"be modeless")},f=function(t){h(t,"modal")},p=function(t,e){var o;"function"==typeof t.isVisible?o=t.isVisible():t instanceof a&&(o=!!AJS.popup.current&&AJS.popup.current.element===t.popup.element);strictEqual(o,!!e,c(t)+" should "+(e?"":"not ")+"be visible")},g=function(t){p(t,!1)},m=function(t){p(t,!0)},w=function(t){strictEqual(document.title,t,"window title should be equal "+t)},b=function(t,e,o){void 0===e&&(e=i.difference(u,t));m(t);e.forEach((function(t){g(t)}));var n,a;"boolean"===o&&(n=o,a=s&&s.$dim&&!s.$dim.attr("hidden"),strictEqual(!!a,!!n,"blanket should "+(n?"":"not ")+"be visible"))},v=function(t,e){b(t,e,!0)},k=function(t,e){b(t,e,!1)},S=function(t,e){var i=o("<div>").css({height:"200px"}).append(o("<h2>").text(t)),a={content:function(t){return t(i)},stacked:!0,height:"200px",windowTitle:t},d=new n(o.extend(a,e));d.isVisible=function(){return i.is(":visible")&&"hidden"!==i.css("visibility")};d.isModeless=function(){return this.get$popup().hasClass(n.ClassNames.MODELESS_DIALOG)};u.push(d);return d},x=function(t,e){var o=new a({width:800,height:500,id:"dialog-name"+e,closeOnOutsideClick:!0,stacked:!0});o.addHeader(t||"some header");u.push(o);return o},j=function(t,e){var i="dialog2-name"+e,n='<section role="dialog" id="'+i+'" class="aui-layer aui-dialog2 aui-dialog2-medium" hidden>             \x3c!-- Dialog header --\x3e             <header class="aui-dialog2-header">'+t+"</header>             <p>Hello World</p>         </section>";o(document.body).append(n);var a=d("#"+i);u.push(a);return a},y=function(t,e,o){o.forEach((function(o){test(AJS.format.apply(this,[t].concat(o.context)),(function(){e.apply(this,o.parameters)}))}))};module("Modeless Dialog Tests",{setup:function(){t=document.title;e=S("modeless dialog",{modeless:!0})},teardown:function(){document.title=t;!function(){u.reverse().forEach((function(t){t.hide()}));u=[];o("."+n.ClassNames.DIALOG).remove();o(".aui-dialog2").remove();o(".aui-dialog").remove()}()}});test("Should show",(function(){e.show();m(e);h(e,"modeless");w(c(e))}));test("Should hide",(function(){e.show();e.hide();g(e);w(t)}));test('Should not change window title when windowTitle is "false"',(function(){S("modeless dialog",{modeless:!0,windowTitle:!1}).show();w(t)}));test("JIRA Dialog should be modal by default",(function(){var t=S("jira dialog");t.show();f(t)}));test('JIRA Dialog should be modal when specified "modeless: false"',(function(){var t=S("jira dialog",{modeless:!1});t.show();f(t)}));!function(){var t=[{parameters:[function(){return S("jira stacked dialog")}],context:["jira dialog"]},{parameters:[function(){return x("aui stacked dialog",1)}],context:["aui dialog"]},{parameters:[function(){return j("aui stacked dialog2",1)}],context:["aui dialog2"]}];y('Should hide when stacked "{0}" is shown',(function(t){var o=t();r(e);r(o);v(o)}),t);y('Should show when stacked "{0}" is hidden',(function(t){var o=t();r(e,o);l(o);k(e)}),t)}();!function(){var t=[{parameters:[function(){return S("jira stacked dialog 1")},function(){return S("jira stacked dialog 2")}],context:["jira dialog","jira dialog"]}],o=function(t,e){return{bottom:t(),top:e()}};y('Should stay hidden when stacked "{0}" is shown on top of stacked "{1}"',(function(t,i){var n=o(t,i);r(e,n.bottom);r(n.top);v(n.top)}),t);y('Should stay hidden when top stacked "{1}" is hidden on top of stacked "{0}"',(function(t,i){var n=o(t,i);r(e,n.bottom,n.top);l(n.top);v(n.bottom)}),t);y('Should show when the bottom stacked "{0}" get hidden together with the top stacked "{1}"',(function(t,i){var n=o(t,i);r(e,n.bottom,n.top);l(n.top);l(n.bottom);k(e)}),t)}();!function(){var t=[{parameters:[function(){return j("aui stacked dialog2 1",1)},function(){return j("aui stacked dialog2 2",2)}],context:["aui dialog2","aui dialog2"]},{parameters:[function(){return x("aui stacked dialog 1",1)},function(){return j("aui stacked dialog2 2",2)}],context:["aui dialog","aui dialog2"]},{parameters:[function(){return j("aui stacked dialog2 1",1)},function(){return x("aui stacked dialog 2",2)}],context:["aui dialog2","aui dialog"]}],o=function(t,e){return{bottom:t(),top:e()}};y('Should stay hidden when stacked "{0}" is shown on top of stacked "{1}"',(function(t,i){var n=o(t,i);r(e,n.bottom);r(n.top);v(n.top,[e])}),t);y('Should stay hidden when top stacked "{1}" is hidden on top of stacked "{0}"',(function(t,i){var n,a,d=o(t,i);r(e,d.bottom,d.top);l(d.top);n=d.bottom,b(n,a,void 0)}),t);y('Should show when the bottom stacked "{0}" get hidden together with the top stacked "{1}"',(function(t,i){var n=o(t,i);r(e,n.bottom,n.top);l(n.top);l(n.bottom);k(e)}),t)}()}));