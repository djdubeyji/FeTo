define("jira/flag",["jira/util/logger","aui/flag","jira/data/session-storage","jira/ajs/ajax/smart-ajax","underscore","jquery","wrm/data","wrm/context-path"],(function(s,e,t,i,n,a,r,o){"use strict";var u={type:"info",title:"",body:""},c={success:{close:"auto"}},f=n.once((function(){return(r.claim("com.atlassian.jira.jira-header-plugin:dismissedFlags.flags")||{}).dismissed||[]}));function d(){return JSON.parse(t.getItem("dismissedFlags"))||[]}function l(e){!function(s){var e=d();if(!n.contains(e,s)){e.push(s);try{t.setItem("dismissedFlags",JSON.stringify(e))}catch(s){}}}(e);i.makeRequest({type:"PUT",url:o()+"/rest/flags/1.0/flags/"+encodeURIComponent(e)+"/dismiss"}).done((function(){!function(s){var e=n.without(d(),s);try{t.setItem("dismissedFlags",JSON.stringify(e))}catch(s){}}(e)})).always((function(){s.trace("flag.dismiss.finished:"+e)}))}function g(s,t,i){i=i||{};var r=n.extend({},u,c[i.type],i,{title:s||"",body:t||""}),o=r.dismissalKey;if(o&&n.contains(n.union(f(),d()),o))return!1;var g=e(r);if(o){g.dismiss=function(){l(o)};g.addEventListener("aui-flag-close",g.dismiss)}else g.dismiss=function(){};var m=a(g).find(".title");""===a.trim(m.text())&&m.remove();return g}var m=d();setTimeout((function(){n.each(m,l)}),1e3);return{showMsg:g,showMessages:function(s){s.forEach((function(s){g(s.title,s.htmlMessage,{close:s.auiClosingPolicy,type:s.auiMessageType})}))},showInfoMsg:g,showErrorMsg:function(s,e,t){return g(s,e,n.extend({},t,{type:"error"}))},showWarningMsg:function(s,e,t){return g(s,e,n.extend({},t,{type:"warning"}))},showSuccessMsg:function(s,e,t){return g(s,e,n.extend({},t,{type:"success"}))}}}));