!function(){"use strict";var e=require("jira/util/events"),r=require("jira/util/events/types"),n=require("jira/util/strings"),i=require("jira/ajs/layer/hide-reasons"),t=require("jira/ajs/layer/layer-interactions"),u=require("jira/util/top-same-origin-window"),a=require("jquery"),o=require("underscore"),c=a(document);function l(e,r){"string"==typeof r&&(r=[r]);return o.any(r,(function(r){return n.contains(e,r)}))}e.bind("Dialog.beforeHide",(function(e){o.any(t.preventDialogHide(),(function(e){return e&&e.current}))&&e.preventDefault()}));e.bind("Dialog.show",(function(e){o.each(t.hideBeforeDialogShown(),(function(r){if(r&&r.current){r.current.hide();e.preventDefault()}}))}));c.bind("beforeBlurInput",(function(e){o.any(t.preventInputBlur(),(function(e){return e&&e.current}))&&e.preventDefault()}));r.BEFORE_INLINE_EDIT_CANCEL&&e.bind(r.BEFORE_INLINE_EDIT_CANCEL,(function(e,r,n,i){if(i===JIRA.Issues.CANCEL_REASON.escPressed){o.any(t.preventInlineEditCancel(),(function(e){return e&&e.current}))&&e.preventDefault()}}));function d(){return u(window)}function s(e){return(e.$layer||e.$popup||e.$||e.popup||e.element||e)[0]}function f(e){e.bind("showLayer",(function(e,r,n){if(!l(n&&n.id,["user-hover-dialog","aui-inline-edit-error","watchers","jira-help-tip"])){var i=d().AJS;i.currentLayerItem&&n!==i.currentLayerItem&&"popup"!==i.currentLayerItem.type&&i.currentLayerItem.hide();if(n){i.currentLayerItem=n;i.currentLayerItem.type=r}}})).bind("hideLayer",(function(e,r,n){if(n&&!l(n.id,["user-hover-dialog","aui-inline-edit-error","jira-help-tip"])){var i=d().AJS;i.currentLayerItem&&(i.currentLayerItem===n?i.currentLayerItem=null:a.contains(s(n),s(i.currentLayerItem))&&i.currentLayerItem.hide())}})).bind("hideAllLayers",(function(){var e=d().AJS;e.currentLayerItem&&e.currentLayerItem.hide()})).click((function(e){var r=d().AJS.currentLayerItem;!r||"popup"===r.type||"inlineDialog"===r.type&&r.persistent||(r._validateClickToClose?r._validateClickToClose(e)&&(r instanceof AJS.InlineLayer?r.hide(i.clickOutside,e):r.hide()):r.hide())}))}c.bind("iframeAppended",(function(e,r){(r=a(r)).load((function(){f(r.contents())}))}));f(c)}();