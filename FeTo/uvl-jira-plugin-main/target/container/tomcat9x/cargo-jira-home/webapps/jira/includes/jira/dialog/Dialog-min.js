var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};define("jira/dialog/dialog",["require"],(function(t){"use strict";var i=t("jira/dialog/dialog-stack"),e=t("jira/ajs/control"),o=t("jira/ajs/layer/inline-layer"),s=t("jira/util/data/meta"),n=t("jira/ajs/ajax/smart-ajax"),r=t("jira/loading/loading"),a=t("jira/xsrf"),d=t("jira/util/browser"),h=t("jira/util/events"),l=t("jira/util/navigator"),c=t("aui/dropdown"),p=t("jquery"),u=t("jira/jquery/deferred"),g=t("jira/jquery/plugins/isdirty"),f=t("underscore"),_=t("wrm/require"),m=t("jira/util/key-code"),v=AJS.bind,y=AJS.unbind,C=AJS.dim,w=AJS.layer,D=AJS.LayerManager.global,b=e.extend({_getDefaultOptions:function(){return{height:"auto",cached:!1,widthClass:"medium",modeless:!1,ajaxOptions:{data:{inline:!0,decorator:"dialog"}},shouldFocusTitleOnLoad:!1}},init:function(t){"string"==typeof t||t instanceof p?t={trigger:t}:t&&t.width&&(t.widthClass="custom");this.classNames=b.ClassNames;this.OPEN_DIALOG_SELECTOR="."+this.classNames.DIALOG+"."+this.classNames.DIALOG_OPEN;this.options=p.extend(!0,this._getDefaultOptions(),t);this.options.width=b.WIDTH_PRESETS[this.options.widthClass]||t.width;this._setType();if(this.options.trigger){var i=p.makeArray(this.options.trigger),e=this;p.each(i,(function(t,i){e._assignEvents("trigger",i)}))}this.onContentReadyCallbacks=[];this.initModeless();this.defineResources();this.options.prefetchResources&&this.downloadResources()},_setType:function(){"function"==typeof this.options.content?this.options.type="builder":this.options.content instanceof p||"object"===_typeof(this.options.content)&&this.options.nodeName?this.options.type="element":(!this.options.type&&!this.options.content||"object"===_typeof(this.options.content)&&this.options.content.url)&&(this.options.type="ajax")},_handleFocusOnLoad:function(){this.options.shouldFocusTitleOnLoad?this.focusTitle():this.focusFirstInteractiveElement()},initModeless:function(){this.options.modeless=!!this.options.modeless;if(this.options.modeless){!1===this.options.windowTitle&&(this.options.windowTitle=document.title);this._temporarilyHidden=!1;this._auiDialogShowHandler=this._auiDialogHandlers.hideTemporarily.bind(this);this._auiDialogHideHandler=this._auiDialogHandlers.restoreVisibility.bind(this);this._auiDialogRemoveHandler=this._auiDialogHandlers.restoreVisibilityRebindable.bind(this);v("show.dialog",this._auiDialogShowHandler);v("hide.dialog",this._auiDialogHideHandler);v("remove.dialog",this._auiDialogRemoveHandler);if(AJS.dialog2){this._auiDialog2ShowHandler=this._auiDialog2Handlers.hideTemporarily.bind(this);this._auiDialog2HideHandler=this._auiDialog2Handlers.restoreVisibility.bind(this);AJS.dialog2.on("show",this._auiDialog2ShowHandler);AJS.dialog2.on("hide",this._auiDialog2HideHandler)}}},_runContentReadyCallbacks:function(){var t=this;p.each(this.onContentReadyCallbacks,(function(){this.call(t)}))},_setContent:function(t,e){var o;if("resolved"===this.resourcesReady().state())if(t)if(i.current===this){this.get$popup().show().css("visibility","hidden").addClass("popup-width-"+this.options.widthClass);this.$content=t;this.get$popupContent().html(t);!1!==e&&this.decorateContent&&this.decorateContent();(o=this.get$popupContent().find("."+this.classNames.HEADING_AREA)).size()>0&&this.get$popupHeading().replaceWith(o);if((o=this.get$popupContent().find("."+this.classNames.CONTENT_AREA)).size()>0){o.contents().insertAfter(o);o.remove()}this._positionInCenter();if(!1!==e){p(document).trigger("dialogContentReady",[this]);this._runContentReadyCallbacks()}this.get$popup().css("visibility","");!1!==e&&p.isFunction(this.options.onContentRefresh)&&this.options.onContentRefresh.call(this);this._onShowContent()}else!1===this.options.cached&&delete this.$content;else this._contentRetrievers[this.options.type].call(this,this._setContent);else{this._showloadingIndicator();this.resourcesReady().done(this._setContent.bind(this,t,e))}},focusFirstInteractiveElement:function(){this.get$popup().find(":focusable:not([tabindex='-1']):first").focus()},focusTitle:function(){this.get$popup().find("h2").focus()},_ellipsify:function(t){t instanceof p||(t=this.get$popup());p(".overflow-ellipsis",t).textOverflow({className:"ellipsified"})},_handleInitialDoneResponse:function(t,i,e){},getRequestUrlFromTrigger:function(){if(this.$activeTrigger&&this.$activeTrigger.length)return this.$activeTrigger.attr("href")||this.$activeTrigger.data("url")},_getRequestOptions:function(){var t={};if(!1===this._getAjaxOptionsObject())return!1;(t=p.extend(!0,t,this._getAjaxOptionsObject())).url||(t.url=this.getRequestUrlFromTrigger());return t},_getAjaxOptionsObject:function(){var t=this.options.ajaxOptions;return p.isFunction(t)?t.call(this):t},_contentRetrievers:{element:function(t){this.$content||(this.$content=p(this.options.content).clone(!0));t.call(this,this.$content)},builder:function(t){var i=this;if(!this.$content){this._showloadingIndicator();this.options.content.call(this,(function(e){i.$content=p(e);t.call(i,i.$content)}),(function(){i._hideloadingIndicator()}))}},ajax:function(t){var i,e=this;if(!this.$content){i=this._getRequestOptions();this._showloadingIndicator();this.serverIsDone=!1;i.complete=function(o,s,r){if(r.successful){var a=e._detectRedirectInstructions(o);e.serverIsDone=a.serverIsDone;if(a.redirectUrl)e._performRedirect(a.redirectUrl);else{i.dataType&&"json"===i.dataType.toLowerCase()&&e._buildContentFromJSON?e.$content=e._buildContentFromJSON(r.data):e.$content=r.data;e.serverIsDone?e._handleInitialDoneResponse(r.data,o,r):t.call(e,e.$content)}}else{var d=n.buildDialogErrorContent(r);t.call(e,d)}};n.makeRequest(i)}}},_detectRedirectInstructions:function(t){var i={serverIsDone:!1,redirectUrl:""},e=t.getResponseHeader("X-Atlassian-Dialog-Control");if(e){i.serverIsDone=!0;0===e.indexOf("redirect:")?i.redirectUrl=e.substr(9):"permissionviolation"===e&&(i.redirectUrl=window.location.href)}return i},_performRedirect:function(t){d.reloadViaWindowLocation(t)},_renders:{popupHeading:function(){return p("<div />").addClass(this.classNames.HEADING_AREA).addClass("jira-dialog-core-heading")},popupContent:function(){return p("<div />").addClass(this.classNames.CONTENT_AREA).addClass("jira-dialog-core-content")},popup:function(){return p("<div />").attr({id:this.options.id||"","aria-labelledby":(this.options.id||"dialog")+"-title",role:"dialog","aria-modal":!0}).addClass(this.classNames.DIALOG).addClass("jira-dialog-core").toggleClass(this.classNames.MODELESS_DIALOG,this.options.modeless).hide()}},_events:{trigger:{simpleClick:function(t,i){this.$activeTrigger=i;this.$activeTrigger.is("a")||(this.$activeTrigger=i.find("a"));this.show();t.preventDefault()}},container:{keydown:function(t){if(t.which===m.ESCAPE){var e=this.handleCancel();l.isIE()&&l.majorVersion()<12&&!1===e&&t.preventDefault()}t.keyCode===m.TAB&&i.current._watchTab(t)}}},handleCancel:function(){return this.hide(!0,{reason:b.HIDE_REASON.escape})},_showloadingIndicator:function(){r.showLoadingIndicator()},_hideloadingIndicator:function(){r.hideLoadingIndicator()},_positionInCenter:function(){var t=p(window),i=this.get$popup(),e=this.getContentContainer(),o=this.getContentArea(),s=t.height(),n=0;"number"==typeof this.options.width&&i.width(this.options.width);if(this.options.modeless)n=Math.round(s/2);else{i.css({marginLeft:-i.outerWidth()/2,marginTop:Math.max(-i.outerHeight()/2,40-s/2)});for(var r=i[0];r;){n+=r.offsetTop;r=r.offsetParent}}var a=Math.max(s-n-40,b.CONSTRAINTS.MODELESS_MIN_HEIGHT),d=parseInt(o.css("padding-top"),10)+parseInt(o.css("padding-bottom"),10);o.css("maxHeight","");var h=a-(i.outerHeight()-e.outerHeight())-d;o.css("maxHeight",h);p(this).trigger("contentMaxHeightChanged",[h])},getContentArea:function(){return this.$popup.find(".form-body")},getContentContainer:function(){var t=this.$popup.find(".content-area-container");return 1===t.length?t:this.$popup.find(".form-body")},get$popup:function(){if(!this.$popup){this.$popup=this._render("popup").appendTo("body");this.$popup.addClass("box-shadow")}return this.$popup},bindAnchorsToDialog:function(t){var i=this;t.click((function(t){i.$activeTrigger=p(this);delete i.$content;i._setContent();t.preventDefault()}))},get$popupContent:function(){this.$popupContent||(this.$popupContent=this._render("popupContent").appendTo(this.get$popup()));return this.$popupContent},get$popupHeading:function(){this.$popupHeading||(this.$popupHeading=this._render("popupHeading").prependTo(this.get$popup()));return this.$popupHeading},getLoadingIndicator:function(){return this.get$popupContent().find(".throbber:last")},showFooterLoadingIndicator:function(){var t=this.getLoadingIndicator();t.length&&(t.data("spinner")?t.hasClass("loading")||t.addClass("loading"):t.addClass("loading").spin())},hideFooterLoadingIndicator:function(){var t=this.getLoadingIndicator();if(t.length){t.removeClass("loading");f.defer((function(){t.hasClass("loading")||t.spinStop()}))}},_watchTab:function(t){var i,e,o;if(p(t.target).parents(this.get$popupContent()).length>0){e=(i=p(':focusable:visible:not([tabindex="-1"])',this.OPEN_DIALOG_SELECTOR)).first();o=i.last();if(t.target===e[0]&&t.shiftKey||t.target===o[0]&&!t.shiftKey){t.shiftKey?o.focus():e.focus();t.preventDefault()}}},_hideCurrentInlineLayer:function(){o.current&&o.current.hide()},_hideCurrentAuiDropdown:function(){c.current&&c.current.hide()},_show:function(t){this._hideCurrentInlineLayer();this._hideCurrentAuiDropdown();var e=i.current;if(e){var o;if(e.options.stacked){(o=e).stacked=!0;o.hide(!1);this.prev=o}else{i.stackroot=this;var s=i.current;o=s._removeStackState();s.hide(!1);for(;o;){o=(s=o)._removeStackState();s._destroyIfNecessary()}}}else if(!0!==this.stacked){i.stackroot=this;i.originalWindowTitle=document.title}this.options.modeless||(this.prev&&this.prev.options.modeless||!0!==this.stacked)&&C(!1);i.current=this;var n=this.get$popup().addClass(this.classNames.DIALOG_OPEN);if(t||"blank"!==this.options.type&&!this.$content&&!0!==this.stacked){delete this.$content;this._setContent()}else{n.show();this._positionInCenter();this._onShowContent()}this._assignEvents("container",document);p(this).trigger("Dialog.show",[this.$popup,this,this.id]);h.trigger("Dialog.show",[this.$popup,this,this.id]);this.options.modeless||d.disableKeyboardScrolling();this._handleFocusOnLoad();this.stacked=!1},show:function(t){var e=this.options.delayShowUntil,o=this;if(i.current===this)return!1;var s=new p.Event("beforeShow"),n=new p.Event("beforeShow");p(this).trigger(s);h.trigger(n,[this.options.id]);if(s.isDefaultPrevented()||n.isDefaultPrevented())return!1;this.downloadResources();if(e){var r=e();if("resolved"===r.state())o._show(t);else{this.options.modeless||C(!1);this._showloadingIndicator();r.done((function(){o._show(t)}))}}else o._show(t)},_setWindowTitle:function(){var t,i,e=this.options.windowTitle,o=this.get$popup();if(!1!==e){"string"==typeof e?t=e:"function"==typeof e?t=e.call(this):(i=o.find("."+this.classNames.HEADING_AREA)).length&&(t=i.text());if(t){var n=s.get("app-title"),r=[t];n&&r.push(n);document.title=r.join(" - ")}}},_onShowContent:function(){this._setWindowTitle();this._hideloadingIndicator();this._ellipsify();this.get$popup().addClass(this.classNames.CONTENT_READY)},_resetWindowTitle:function(){if(!0!==this.stacked&&i.stackroot===this&&i.originalWindowTitle){document.title!==i.originalWindowTitle&&(document.title=i.originalWindowTitle);i.originalWindowTitle=void 0}},notifyOfNewContent:function(){if(this.$content){this.decorateContent();this._positionInCenter();this._onShowContent();p(document).trigger("dialogContentReady",[this])}},destroy:function(){if(this.options.modeless){if(AJS.dialog2){AJS.dialog2.off("show",this._auiDialog2ShowHandler);AJS.dialog2.off("hide",this._auiDialog2HideHandler);delete this._auiDialog2ShowHandler;delete this._auiDialog2HideHandler}y("show.dialog",this._auiDialogShowHandler);y("hide.dialog",this._auiDialogHideHandler);y("remove.dialog",this._auiDialogRemoveHandler);delete this._auiDialogShowHandler;delete this._auiDialogHideHandler;delete this._auiDialogRemoveHandler}this.$popup&&this.$popup.remove();delete this.$popup;delete this.$popupContent;delete this.$popupHeading;delete this.$content},_destroyIfNecessary:function(){!this.options.cached&&this.destroy()},_removeStackState:function(){var t=this.prev;delete this.prev;delete this.stacked;return t},isCurrent:function(){return i.current===this},hide:function(t,e){if(i.current===this){var o=new p.Event("Dialog.beforeHide"),s=new p.Event("Dialog.beforeHide");e=e||{};h.trigger(o,[this.$popup,e.reason,this.options.id]);p(this).trigger(s,[this.$popup,e.reason,this.options.id]);if(o.isDefaultPrevented()||s.isDefaultPrevented())return!1;this._updateXSRFToken();(!1!==t&&!this.prev&&!this.options.modeless||this.prev&&this.prev.options.modeless)&&AJS.undim();this.get$popup().removeClass(this.classNames.DIALOG_OPEN).removeClass(this.classNames.CONTENT_READY).hide();this._hideloadingIndicator();this._resetWindowTitle();this._unassignEvents("container",document);p(document).trigger("hideAllLayers",[this.$popup,e.reason,this.options.id]);p(this).trigger("Dialog.hide",[this.$popup,e.reason,this.options.id]);h.trigger("Dialog.hide",[this.$popup,e.reason,this.options.id]);i.current=null;!1===this.options.cached&&!0!==this.stacked&&this.destroy();this.options.modeless||d.enableKeyboardScrolling();if(!0!==this.stacked)if(this.prev){this.prev.show(!!this.prev.options.reloadOnPop);delete this.prev}else i.stackroot===this&&(i.stackroot=void 0)}},_updateXSRFToken:function(){var t=p("input[name=atl_token]",this.OPEN_DIALOG_SELECTOR).attr("value");void 0!==t&&a.updateTokenOnPage(t)},addHeading:function(t){var i=p("<div />").html(t).contents(),e=p("<h2 tabindex='-1' />");e.attr("id",(this.options.id||"dialog")+"-title");var o=[];i.each((function(){"div"===this.nodeName.toLowerCase()?o.push(this):e.append(this)}));this.get$popupHeading().html(o).prepend(e)},onContentReady:function(t){p.isFunction(t)&&this.onContentReadyCallbacks.push(t)},_auiDialogHandlers:{hideTemporarily:function(){this._temporarilyHidden||this._hideTemporarily()},restoreVisibility:function(){if(this._temporarilyHidden){var t=D.getTopLayer(),i=!!t&&w(t);i&&i.isVisible()&&i.isBlanketed()||this._restoreVisibility()}},restoreVisibilityRebindable:function(t,i){this._restoreVisibility(t,i);setTimeout(function(){v("remove.dialog",this._auiDialogRemoveHandler)}.bind(this),0)}},_auiDialog2Handlers:{hideTemporarily:function(){this._temporarilyHidden||this._hideTemporarily()},restoreVisibility:function(){if(this._temporarilyHidden&&(!AJS.popup.current||!AJS.popup.current.element.is(":visible"))){AJS.LayerManager.global.getTopLayer()||this._restoreVisibility()}}},_hideTemporarily:function(){this.get$popup().addClass(this.classNames.DIALOG_NOT_VISIBLE);this._temporarilyHidden=!0},_restoreVisibility:function(){this.get$popup().removeClass(this.classNames.DIALOG_NOT_VISIBLE);this._temporarilyHidden=!1},defineResources:function(){f.isFunction(this.options.defineResources)&&this.options.defineResources.call(this)},requireContext:function(t){this.requireResource(t,"wrc!")},requireResource:function(t,i){this.wrmResources=this.wrmResources||[];this.wrmResources.push((i||"wr!")+t)},getRequiredResources:function(){return this.wrmResources||[]},downloadResources:function(){this.getRequiredResources().length>0&&!this.deferredResources&&(this.deferredResources=_(this.getRequiredResources()))},resourcesReady:function(){return this.deferredResources?this.deferredResources.promise():(new u).resolve().promise()}});b.fn.dirtyFormWarning=function(){return this.bind("Dialog.beforeHide",(function(t,i,e){if(!t.isDefaultPrevented()&&(e===b.HIDE_REASON.cancel||e===b.HIDE_REASON.escape)){var o=g.getDirtyWarning();o&&!confirm(o)&&t.preventDefault()}}))};b.ClassNames={DIALOG:"jira-dialog",HEADING_AREA:"jira-dialog-heading",CONTENT_AREA:"jira-dialog-content",DIALOG_OPEN:"jira-dialog-open",CONTENT_READY:"jira-dialog-content-ready",MODELESS_DIALOG:"jira-dialog-modeless",DIALOG_NOT_VISIBLE:"jira-dialog-not-visible"};b.WIDTH_PRESETS={small:360,medium:540,large:810};b.CONSTRAINTS={MODELESS_MIN_HEIGHT:240};b.HIDE_REASON={cancel:"cancel",escape:"esc",submit:"submit"};Object.defineProperty(b,"current",{get:function(){console.warn(i.currentDeprecationMsg);return i.current},set:function(t){console.warn(i.currentDeprecationMsg);i.current=t}});return b}));AJS.namespace("AJS.FlexiPopup",null,require("jira/dialog/dialog"));AJS.namespace("JIRA.Dialog",null,require("jira/dialog/dialog"));