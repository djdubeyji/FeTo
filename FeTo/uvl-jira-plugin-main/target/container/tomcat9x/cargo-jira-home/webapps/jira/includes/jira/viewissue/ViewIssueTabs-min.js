define("jira/viewissue/tabs",["wrm/require","jira/util/logger","jquery","jira/jquery/deferred","jira/util/data/meta","jira/dialog/form-dialog","jira/ajs/ajax/smart-ajax","jira/userhover/userhover","jira/viewissue/tabs/analytics"],(function(t,e,a,i,n,s,r,o,u){"use strict";var c,l,d,f=JIRA.Templates.Issue.Tabs,h=!1!==n.get("viewissue-use-history-api"),v="ajax-activity-content",m="#activitymodule div.mod-content",p="."+v,g=[];function b(t){t=t||document;a.each(g,(function(e,a){a(t)}))}function y(t){a("#issue-tabs li").each((function(){var e=a(this),i=e.data("key"),n=e.data("label");if(i===t){e.addClass("active");e.html(f.label({text:n}))}else{e.removeClass("active");var s=e.data("id"),r=e.data("href");e.html(f.tab({id:s,href:r,linkClass:v,text:n}))}}));j(a("#issue-tabs"))}function j(e){var i=a(e).find("li.active").data("key");a(e).find(p).click((function(e){document.getElementById("activitymodule").classList.add("updating");var n=a(this),s=n.hasClass("issue-activity-sort-link"),r=a("#issue-tabs .active-tab").data("id");s?t("wr!com.atlassian.jira.jira-frontend-plugin:entrypoint-activityTabs").then((function(){require("jira/activity-tabs/items-lazy-loader").then((function(t){t.getRegisteredTabsIds().includes(r)?document.getElementById("activitymodule").classList.remove("updating"):w(n,i,e)}))})):w(n,i,e)}))}function w(t,n,o){var f=function(t,e){var a=t.pageX,i=t.pageY,n=e.offset(),s=e.outerWidth(),r=e.outerHeight();return 0===a&&0===i||!(a>=n.left&&a<=n.left+s&&i>=n.top&&i<=n.top+r)}(o,t),v=t.parent().data("key"),p=o.metaKey;v?u.tabClicked(t,p,f):u.buttonClicked(t,p,f);if(!p){o.preventDefault();v&&function(t){y(t)}(v);(function(t,n){var o=i();d&&d.abort();var u=r.makeRequest({jqueryAjaxFn:h?a.pjax:a.ajax,headers:{"X-PJAX":!0},container:m,url:n,timeout:null,complete:function(i,n,u){if("abort"!==n){d=null;if(!u.successful){(u.status<300||u.status>=400)&&function(t,e){var a=new s({id:"issue-tab-error-dialog",widthClass:"small",content:r.buildDialogErrorContent(t,!1)});y(e);l.show();a.show()}(u,t);return}var c=a(this.container),f=document.createElement("div");f.innerHTML=u.data;var v=document.createDocumentFragment().appendChild(f);h||function(t,e){l=q();var i=e.querySelectorAll(".tabwrap"),n=t.find(".tabwrap"),s=a(e.querySelectorAll("#issue_actions_container")).contents(),r=l.contents();if(i.length&&n.length&&s.length&&r.length){n.replaceWith(i);l.stop(!0,!0);var o=l.height();l.append(s);var u=l.height()-o,c=o-u;if(c>0){l.css("height",u+c);r.remove();!function(t,e){var a=150,i=800,n=Math.min(e/i*1e3,1e3);setTimeout((function(){l.animate({height:t+1},n,"easeOutQuart",(function(){l.css("height","auto")}))}),a)}(u,c)}else l.empty().append(s);a(e.querySelectorAll("script")).each((function(){a.globalEval(this.text||this.textContent||this.innerHTML||"")}))}else t.empty().append(e)}(c,v);e.trace("jira.issue.tab.loaded");o.resolve(c)}}});a(u).throbber({target:c});d=u;return o})(n,t.data("ajax")||t.attr("href")).done((function(e){document.getElementById("activitymodule").classList.remove("updating");f&&(v?e.find("#"+t.attr("id")+" > :first-child").focus():e.find(".sortwrap  > :first-child").focus())})).done(b)}}function x(t){a.inArray(t,g)<0&&g.push(t)}function q(){return a(m).find("#issue_actions_container")}x((function(t){var e=a(t).find(".issuePanelWrapper"),i=q();l=i.length?i:l;c=e.length?e:c}));x((function(t){!h||a.support.pjax?j(t):function(t){a(t).find(p).each((function(){var t=a(this);t.attr("href",t.attr("href")+"#issue-tabs")}))}(t)}));x((function(t){a(t).bind("moveToFinished",(function(t,e){a("a.twixi:visible",e).focus()}))}));x(o);x((function(t){t.find("time.livestamp").livestamp()}));return{onTabReady:x,domReady:b}}));AJS.namespace("JIRA.ViewIssueTabs",null,require("jira/viewissue/tabs"));