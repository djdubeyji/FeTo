define("jira/versionblocks/version-blocks",["jquery"],(function(e){"use strict";var n={ClassNames:{VERSION_LIST:"versions-list",VERSION_CONTAINER:"version-block-container",EXPANDED_CONTENT_CONTAINER:"version-issue-table"},init:function(){var o=n.ClassNames,a=e("."+o.VERSION_LIST).first(),i=window.document.location.href.replace(window.document.location.hash,"").replace(window.document.location.search,"");e(document).on("click","a[data-version-block]",(function(n){var s=e(this),d=s.closest("."+o.VERSION_CONTAINER),c=d.data("expanded"),r=d.find("."+o.EXPANDED_CONTENT_CONTAINER),l=e("<span class='icon loading'></span>");r.size()||(r=e("<div/>").addClass(o.EXPANDED_CONTENT_CONTAINER).hide().appendTo(d));var N={};N[c?"collapseVersion":"expandVersion"]=d.find("[data-version-id]").data("version-id");var u,p,f=e.ajax({url:i,data:(u=N,p={decorator:"none",contentOnly:!0,noTitle:!0,selectedTab:t(),pid:a.data("project-id"),component:a.data("component-id")},e.extend(p,u)),dataType:"json",beforeSend:function(){s.closest("ul").append(e("<li/>").append(l))}});f.always((function(){l.parent("li").remove()}));f.fail((function(){console.log("Failed to load issues for version. User-facing error to do, sorry :(",arguments)}));c?f.done((function(){r.hide()})):f.done((function(n){var a=e("<div/>").html(n.content).find("."+o.EXPANDED_CONTENT_CONTAINER);r.hide().replaceWith(a).show()}));f.done((function(){d.data("expanded",!c)}));n.preventDefault()}));function t(){var e=a.data("selected-tab"),n=""+window.document.location.search+window.document.location.hash;if(n.indexOf("selectedTab=")>-1){e=n.replace(/^.*selectedTab=(.*?)(?:&.*$|$)/,"$1");e=decodeURIComponent(e)}return e}}};return n}));AJS.namespace("JIRA.VersionBlocks",null,require("jira/versionblocks/version-blocks"));