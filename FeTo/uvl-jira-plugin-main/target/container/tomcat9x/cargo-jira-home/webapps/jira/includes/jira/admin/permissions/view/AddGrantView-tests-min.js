AJS.test.require("jira.webresources:projectpermissions",(function(){"use strict";var e=require("jquery"),i=require("underscore"),r=require("jira/project/permissions/addgrantview"),t=require("jira/project/permissions/grantmodel"),s=require("jira/project/permissions/securitytypes");module("projectpermissions/add-grant-view");function n(e,i){return function(e,i,r,s,n){return new t({securityType:e,displayName:i,primary:r,values:s,help:n})}("user","User",!1,e,i)}function l(){return n([],null)}test("A user with no browse user permission shows info icon",(function(){var e=new r({model:n([],{infoText:"No permission",helpText:"More help",helpUrl:"url"})});e.render();ok(e.$el.find(".grant-permission-inline-dialog").length>0)}));test("A user with browse user permission does not show info icon ",(function(){var e=new r({model:l()});e.render();ok(0===e.$el.find(".aui-icon.icon-help").length)}));test("Selecting radio button toggles display of any textboxes",(function(){var i=new r({model:l()});i.render();e("#qunit-fixture").append(i.$el);ok(!i.$el.find("#user-single-select").is(":visible"),"Input view should not be visible");i.$el.find(".security-type-item-radio-btn").click();ok(i.$el.find("#user-single-select").is(":visible"),"After radio click, input view should be visible")}));test("Test event was added and initial value is stored in the model",(function(){var e=[s.USER_CF,s.GROUP_CF,s.PROJECT_ROLE,s.APPLICATION_ROLE,s.GROUP,s.SINGLE_USER];i.each(e,(function(e){var i=new r({model:new t({securityType:e,displayName:"Test1",primary:!1,values:[{value:"val1",displayValue:"dispVal1"},{value:"val2",displayValue:"dispVal2"}]})}),n=i.renderInput();ok(n,"Expected render input for "+e);ok(n.model.$element.data("events").selected);if(s.SINGLE_USER===e)strictEqual(i.model.get("securityTypeParamVal"),null,"No value set for single user there is no default");else{strictEqual(i.model.get("securityTypeParamVal").length,1,"Expecting only the first value");var l=i.model.get("securityTypeParamVal")[0];s.APPLICATION_ROLE===e?strictEqual(l,"","Expected empty string representing Any logged in user"):s.GROUP===e?strictEqual(l,"","Expected empty string representing Anyone"):strictEqual(l,"val1","Expecting the first value")}}))}))}));