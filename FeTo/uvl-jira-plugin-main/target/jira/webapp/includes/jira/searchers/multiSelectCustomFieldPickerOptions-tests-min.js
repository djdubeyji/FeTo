AJS.test.require(["jira.webresources:searchers"],(function(){"use strict";var e=this,t=require("jira/searchers/element/multi-select-custom-field-picker-options"),o=require("jira/util/formatter"),s=require("wrm/context-path"),a={baseAjaxOptions:{customFieldId:10101,projectIds:["10001","10003"],issueTypeIds:["12003","12005","12008"]}},n={options:[{id:101234,value:"Option 1"},{id:104352,value:"Option A"},{id:987654,value:"Awesome option"}],total:3};module("multiSelectCustomFieldPickerOptions",{setup:function(){e.sandbox=sinon.sandbox.create();e.formatSpy=e.sandbox.spy(o,"format")},teardown:function(){e.sandbox.restore()}});test("should setup picker options",(function(){var e=t(a);equal(e.maxInlineResultsDisplayed,100,"maxInlineResultsDisplayed is defined by common options");equal(e.maxResultsDisplayedPerGroup,100,"maxResultsDisplayedPerGroup is defined by common options")}));test("should setup ajax options",(function(){var e=a.baseAjaxOptions.customFieldId,o=t(a);ok(o.ajaxOptions,"AjaxOptions are defined");equal(o.ajaxOptions.url,s()+"/rest/api/latest/customFields/"+e+"/options","REST endpoint path is defined");equal(o.ajaxOptions.data.maxResults,100,"maxResults is correctly set");ok("function"==typeof o.ajaxOptions.formatResponse,"formatResponse method is defined")}));test("should set debouncing",(function(){var e=t(a);equal(!e.query,!0,"Debouncing is in use")}));test("should correctly format the response",(function(){var e=t(a).ajaxOptions.formatResponse(n)[0],o=e.items();equal(o.length,n.options.length,"Items have correct length");var s=o.every((function(e,t){return e.label()===n.options[t].value&&e.value()===n.options[t].id.toString()}));ok(s,"Items have correct properties");equal(e.fetchedThroughAjaxCall(),!0,"GroupDescriptor is marked as having data from the server")}));test("should not add footer text to items when all were returned",(function(){var e=t(a).ajaxOptions.formatResponse(n);equal(e[0].footerText(),void 0,"Footer text is not present")}));test("should add footer text to items when not all were returned",(function(){var o={options:n.options,total:5},s=t(a).ajaxOptions.formatResponse(o);equal(e.formatSpy.calledOnce,!0,"Formatter was called once");equal(e.formatSpy.calledWith("common.concepts.too.many.matches",2),!0,"Formatter was called with proper arguments");equal(s[0].footerText(),"common.concepts.too.many.matches","Footer text is present")}))}));