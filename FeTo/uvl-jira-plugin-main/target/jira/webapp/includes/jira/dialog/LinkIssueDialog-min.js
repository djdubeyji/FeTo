define("jira/dialog/link-issue-dialog-factory",["require"],(function(e){"use strict";var i=e("jira/deprecator"),n=e("jira/dialog/dialog-factory"),t=e("jira/dialog/form-dialog"),s=e("jira/dialog/dialog-util"),o=e("jira/ajs/ajax/smart-ajax"),r=e("jira/issue"),a=e("jira/issuenavigator/issue-navigator"),u=e("jquery"),l=e("jira/jquery/deferred"),c=e("wrm/context-path"),d=e("wrm/require"),g=c(),f=e("jira/analytics"),p=e("jira/util/logger"),m=e("jira/util/browser");function h(){return"link.issue.dialog"}function j(e){return new t({id:"link-issue-dialog",isIssueDialog:!0,trigger:e,onSuccessfulSubmit:function(e,i){"warning"!==i.getResponseHeader("X-Atlassian-Dialog-Msg-Type")&&s.storeCurrentIssueIdOnSucessfulSubmit.apply(this,arguments)},issueMsg:"thanks_issue_linked",widthClass:"large",stacked:!0,content:function(e,i){var n=this,t=r.getIssueId()||a.getSelectedIssueId(),c=d("wrc!link.issue.dialog");u.when(c).done((function(){var i=function(e){var i=new l;o.makeRequest({url:g+"/rest/viewIssue/1/remoteIssueLink/linkType?issueId="+e,complete:function(e,n,t){t.successful?i.resolve(t.data):i.reject(o.buildDialogErrorContent(t))}});return i.promise()}(t),r=function(e){var i=new l,n=s.getDefaultAjaxOptions.call(e);n.complete=function(e,n,t){t.successful?i.resolve(t.data):i.reject(o.buildDialogErrorContent(t))};o.makeRequest(n);return i.promise()}(n);u.when(r,i).done((function(i,t){t=function(e,i){var n=!1;u.each(i,(function(i,t){if(t.id===e){t.isSelected=!0;n=!0;return!1}}));n||(i[0].isSelected=!0);return i}(function(e){return e.$activeTrigger.attr("id")}(n),t);e(JIRA.Templates.LinkIssue.dialog({linkTypes:t,tabContent:i}));u.each(t,(function(e,i){var t;if(!0===i.isSelected){t="[name='"+i.focusedFieldName+"']";0===u(t).length&&(t="#"+i.id);n._focusFirstField(t)}}))})).fail((function(i,n){e(n||i)}))})).fail((function(){i();u.when(d("wr!com.atlassian.jira.plugin.system.issueoperations:link-issue-error-dialog")).done((function(){var e=AJS.dialog2(u(JIRA.Templates.LinkIssue.errorDialog())).on("show",(function(){f.send({name:"link.issue.dialog.loading.ui.resources.failed"})}));e.$el.find("#error-dialog-button").click((function(){m.reloadViaWindowLocation()}));e.show()})).fail((function(e){p.error(e)}))}))},formatSubmitResponseContent:function(e){this.get$popupContent().find(".dialog-pane").html(e);return this.get$popupContent().html()},onContentRefresh:function(){this.bindAnchorsToDialog(this.get$popupContent().find(".dialog-menu-item "))}})}n.createLinkIssueDialog=j;i.prop(n,"createLinkIssueDialog",{sinceVersion:"7.3",removeInVersion:"8.0"});return{createLinkIssueDialog:j,webResourcesContextName:h}}));