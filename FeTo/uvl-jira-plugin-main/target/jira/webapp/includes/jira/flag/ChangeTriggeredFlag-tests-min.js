AJS.test.require(["jira.webresources:edit-project-details"],(function(){"use strict";var e=require("jquery"),a=require("underscore"),n=require("jira/project/edit/change-triggered-flag");module("JIRA.Project.Flag.ChangeTriggeredFlag",{setup:function(){this.changeTriggeredFlag=l.call(this)},teardown:function(){e("#aui-flag-container").remove()}});function c(){var a=e("#aui-flag-container").find(".aui-flag");return a.length>0&&"open"===a.attr("open")}function l(e){this.value=0;var c=this;c.cancelCallback=sinon.spy();e=a.defaults(e||{},{getValue:function(){return c.value},revert:function(){c.value=0},warningDescription:function(){return"warning"},cancelMessage:function(){return"cancel"},onCancelCallback:c.cancelCallback});return new n(e)}test("On a value change the flag is shown",(function(){this.value=1;this.changeTriggeredFlag.changeOccurred();ok(c(),"Should have shown the flag on a change")}));test("On changing the value back the flag should go away",(function(){this.value=1;this.changeTriggeredFlag.changeOccurred();ok(c(),"Should have shown the flag on a change");this.value=0;this.changeTriggeredFlag.changeOccurred();ok(!c(),"Should have hidden the flag");ok(this.cancelCallback.calledOnce)}));test("Clicking cancel on the flag reverts to the original value",(function(){this.value=1;this.changeTriggeredFlag.changeOccurred();e("#aui-flag-container").find(".aui-flag a.cancel").click();this.changeTriggeredFlag.changeOccurred();equal(this.value,0,"Should have reverted back to the original value");ok(this.cancelCallback.calledOnce)}));test("Clicking dismiss on flag will never show it again even when changing",(function(){this.value=1;this.changeTriggeredFlag.changeOccurred();e("#aui-flag-container").find(".aui-close-button").click();ok(!c(),"Should have hidden the flag when cancelled");this.value=2;this.changeTriggeredFlag.changeOccurred();ok(!c(),"Should have hidden the flag when cancelled");this.value=0;this.changeTriggeredFlag.changeOccurred();ok(!c(),"Should have hidden the flag when cancelled");this.value=2;this.changeTriggeredFlag.changeOccurred();ok(!c(),"Should have hidden the flag when cancelled")}))}));