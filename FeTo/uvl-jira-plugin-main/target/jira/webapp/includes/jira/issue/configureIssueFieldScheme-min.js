define("jira/issue/configureissuefieldscheme",["underscore","jquery","marionette","jira/analytics"],(function(t,e,i,s){"use strict";return i.View.extend({ui:{defaultOptionSelect:"#default-option-select",addAllButton:"#addAllAvailableOptions",removeAllButton:"#removeAllSelectedOptions",selectedOptions:"#selectedOptions",availableOptions:"#availableOptions",submitButton:"#submitSave"},events:function(){this.options&&t.isObject(this.options.ui)&&t.extend(this.ui,this.options.ui);return{"click @ui.addAllButton":"moveAll","click @ui.removeAllButton":"moveAll","click @ui.submitButton":"submitForm"}},initialize:function(t){var e=this;this.bindUIElements();this.optionsKey=t.optionsKey||"selectedOptions";this.ui.selectedOptions.sortable({opacity:.7,connectWith:this.ui.availableOptions,update:function(t,i){i.sender||i.item.parent().is(e.ui.availableOptions)||e.sendAnalyticsEvent("reordered")},receive:function(){e.sendAnalyticsEvent("added")},remove:function(){e.sendAnalyticsEvent("removed")}});this.ui.availableOptions.sortable({update:this.restrictOptions.bind(this),opacity:.7,connectWith:this.ui.selectedOptions});this.restrictOptions()},moveAll:function(t){t.preventDefault();var e=void 0,i=void 0;if(this.ui.addAllButton.is(t.target)){e=this.ui.availableOptions;i=this.ui.selectedOptions}else{e=this.ui.selectedOptions;i=this.ui.availableOptions}e.find("li").appendTo(i);this.restrictOptions()},sendAnalyticsEvent:function(t){s.send({name:"administration.issuetypeschemes.issuetype."+t+".global"})},getSelectedOptions:function(){return this.ui.selectedOptions.sortable("serialize",{key:this.optionsKey})||this.optionsKey+"="},restrictOptions:function(){var i=this.getSelectedOptions().replace(new RegExp(this.optionsKey+"=","g"),"").split("&"),s=this.ui.defaultOptionSelect.get(0),n=s.options[0];Array.prototype.slice.call(s.options,1).forEach((function(s){var o=e(s);if(t.contains(i,s.value))o.prop("disabled",!1).removeClass("hidden");else{if(s.selected){s.selected=!1;n.selected=!0}o.prop("disabled",!0).addClass("hidden")}}))},submitForm:function(t){var e=t.target.form;e.action=e.action+"?"+this.getSelectedOptions();return!0}})}));