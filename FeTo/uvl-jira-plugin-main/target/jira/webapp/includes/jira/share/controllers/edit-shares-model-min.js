define("jira/share/controllers/edit-shares-model",["aui/message","jquery","jira/util/formatter"],(function(e,t,i){"use strict";function r(e){this.mode=e;this.counter=0;this.displayDiv=this.getModeElementById("share_display_div");this.emptyDiv=this.getModeElementById("empty_share");this.shareDiv=this.getModeElementById("share_div")}r.prototype={initialise:function(){var e=this.getModeElementById("share_busy");if(e){e.style.display="none";e.parentNode&&e.parentNode.removeChild(e)}this.shareDiv.style.display=""},setupDefaultShareType:function(){var e=this.getModeElementById("share_type_selector"),t=e.options[e.selectedIndex].value;this.getModeElementById("share_"+t).style.display="";return t},onFilterEdit:function(e){if("viewers"===this.mode){var t=document.getElementById("share_type_hidden_editors");if(t)try{var i=JSON.parse(e.value);i.forEach((function(e){e.rights={value:1}}));var r=JSON.parse(t.value);r.forEach((function(e){e.rights={value:3}}));e.value=JSON.stringify(i.concat(r));t.parentNode.removeChild(t)}catch(e){console.log("Error parsing JSON data: "+e)}this.removeEditorsSelect("group-share");this.removeEditorsSelect("project-share");this.removeEditorsSelect("role-share")}},setWarning:function(t,i){var r=document.getElementById("share_warning");r&&(t.length>0?e.warning("#share_warning",{body:t,title:i,closeable:!1,shadowed:!1}):r.innerHTML="")},getModeElementById:function(e){return document.getElementById(e+"_"+this.mode)},removeEditorsSelect:function(e){var t=document.querySelector(".editors select."+e);t&&t.parentNode.removeChild(t)},animateShare:function(e){var i=this.getModeElementById("share_div_"+e+"_inner");if(i){for(var r=i.parentNode,a=null;!a&&r&&r!==document.body.parentNode;){r.style&&(a=r.style.backgroundColor);!a&&r.bgColor&&(a=r.bgColor);r=r.parentNode}a||(a="#FFFFFF");if(!t(i).hasClass("fading")){t(i).addClass("fading");t(i).css({backgroundColor:"#FFCCCC"}).animate({backgroundColor:"#FFFFFF"},2e3,(function(){t(i).removeClass("fading")}))}}},addDisplay:function(e,i,r){var a=this.counter++;i.className="shareItem";i.id="share_div_"+a+"_"+this.mode;var s=document.createElement("div"),n="share_div_"+a+"_inner_"+this.mode;s.id=n;s.title=e.description;var d=this.cloneImage("share_icon");d&&s.appendChild(d);var o=document.createElement("span");o.id=n+"_span";e.dataSpanId=o.id;o.innerHTML=e.display;s.appendChild(o);var l=this.cloneImage("share_trash");if(l){t(l).click((function(e){r(e,a)}));s.appendChild(l)}i.appendChild(s);this.appendToDisplayDiv(i);e.key&&e.updateDisplayName();return a},remove:function(e,t){var i=this.getModeElementById("share_div_"+e);if(t>=1)this.displayDiv.removeChild(i);else{i.innerHTML=this.emptyDiv.innerHTML;i.className=this.emptyDiv.className;i.removeAttribute("id")}},clearDiv:function(){for(;this.displayDiv.firstChild;){if("div"===this.displayDiv.firstChild.nodeName.toLowerCase()){for(var e=this.displayDiv.firstChild;e.nextSibling;)this.displayDiv.removeChild(e.nextSibling);return e}this.displayDiv.removeChild(this.displayDiv.firstChild)}},recalculateHiddenValue:function(e){var t=this.getModeElementById("share_type_hidden");if(t){var i=e.map((function(e){return e.permission}));t.value=JSON.stringify(i)}},appendToDisplayDiv:function(e){this.displayDiv.appendChild(e)},displayEmptySharesTemplate:function(){var e=this.emptyDiv.cloneNode(!0);e.removeAttribute("id");e.style.display="";this.appendToDisplayDiv(e)},getSelectedType:function(){for(var e=this.getModeElementById("share_type_selector"),t=e.options,i=void 0,r=0;r<t.length;r++){var a=this.getModeElementById("share_"+t[r].value);a&&(r===e.selectedIndex?i=a:a.style.display="none")}i.style.display="";return t[e.selectedIndex].value},cloneImage:function(e){var t=this.getModeElementById(e);if(t){(t=t.cloneNode(!0)).removeAttribute("id");t.style.display=""}return t},improveSelectArialabel:function(e,t){var i=e.closest("fieldset").find(".js-default-single-group-picker"),r=i.attr("aria-label");i.attr("aria-label",r+" "+t)},getSelectList:function(){return this.getModeElementById("share_type_selector")},getShareTypeSelector:function(){return t("#share_type_selector_"+this.mode)},getSubmitButton:function(){return this.getForm().find("input[type=submit]")},getForm:function(){if(void 0===t("body").data("loaded")){t("body").attr("data-loaded","loaded");var e=t("#share_type_selector_viewers"),r=t("#share_type_selector_editors");e.length&&this.improveSelectArialabel(e,i.I18n.getText("dashboard.create.select.group.viewers"));r.length&&this.improveSelectArialabel(r,i.I18n.getText("dashboard.create.select.group.editors"))}return t("#edit-entity")}};return r}));