define("jira/share/entities/share-type/project-share",["jira/share/entities/display","jira/share/entities/share-permission","jira/share/i18n","jquery"],(function(e,t,r,s){"use strict";function i(e){this.roleMap={};this.projectMap={};this.type="project";this.singleton=!1;this.parentElement=document.querySelector("."+e);this.dirty=!1}i.prototype={initialise:function(){var e=this;this.projectSelect=this.getSubElement("project-share");this.roleSelect=this.getSubElement("role-share");this.roleSelectGroup=this.getSubElement("role-group-share");if(this.roleSelect&&this.projectSelect&&this.roleSelectGroup){var t,r;for(r=1;r<this.roleSelect.options.length;r++){t=this.roleSelect.options[r];this.roleMap[t.value]=t.text}for(r=0;r<this.projectSelect.options.length;r++){t=this.projectSelect.options[r];this.projectMap[t.value]=t.text}this.setRoles();s(this.projectSelect).change((function(t){e.dirty=!0;e.changeCallbackForProject(t)}))}},getDisplayFromUI:function(){if(this.projectSelect&&this.roleSelect){var s,i=this.projectSelect.options[this.projectSelect.selectedIndex],o=i.value,l=i.text,n=this.roleSelect.options[this.roleSelect.selectedIndex],a=n.value,c=n.text;if(""===a){s=r.getMessage("share_project_display_all");s=r.formatMessage(s,l)}else{s=r.getMessage("share_project_display");s=r.formatMessage(s,l,c)}var p=new t(this.type,o,a);return new e(s,this.getDescriptionString(l,a,c,!0),this.singleton,p)}},inputChangesExist:function(){return this.dirty},getDisplayDescriptionFromUI:function(){if(!this.projectSelect||!this.roleSelect)return"";var e=this.projectSelect.options[this.projectSelect.selectedIndex].text,t=this.roleSelect.options[this.roleSelect.selectedIndex],r=t.value,s=t.text;return this.getDescriptionString(e,r,s,!1)},getDescriptionString:function(e,t,s,i){var o;if(t&&""!==t){o=r.getMessage("share_role_description");o=i?r.formatMessageUnescaped(o,s,e):r.formatMessage(o,s,e)}else{t=null;o=r.getMessage("share_project_description");o=i?r.formatMessageUnescaped(o,e):r.formatMessage(o,e)}return o},getDisplayFromPermission:function(s){var i,o,l,n,a;if(!s||s.type!==this.type||!s.param1)return null;if(s.param2){n=this.getProject(s.param1);a=this.getRole(s.param2);i=r.getMessage("share_project_display");i=r.formatMessage(i,n,a);o=new t(this.type,s.param1,s.param2);l=this.getDescriptionString(n,s.param2,a,!0)}else{n=this.getProject(s.param1);i=r.getMessage("share_project_display_all");i=r.formatMessage(i,n);o=new t(this.type,s.param1,null);l=this.getDescriptionString(n,null,null,!0)}return new e(i,l,this.singleton,o)},getDisplayWarning:function(){return""},changeCallbackForProject:function(){this.setRoles()},setProject:function(e){if(this.projectSelect)for(var t=this.projectSelect.options,r=0;r<t.length;r++)t[r].value===e&&(t[r].selected=!0)},setRoles:function(e){if(this.projectSelect&&this.roleSelect&&this.roleSelectGroup){var t,r=this.projectSelect.options[this.projectSelect.selectedIndex].getAttribute("roles");if(r)try{(t=JSON.parse(r))||(t=[])}catch(e){t=[]}else t=[];if(this.roleSelectGroup.parentNode){this.roleSelect.removeChild(this.roleSelectGroup);this.roleSelectGroup=this.roleSelectGroup.cloneNode(!1)}var s=null;if(t.length>0){for(var i=0;i<t.length;i++){var o=document.createElement("OPTION");o.appendChild(document.createTextNode(this.roleMap[t[i]]));var l=t[i];o.value=l;l===e&&(s=o);this.roleSelectGroup.appendChild(o)}this.roleSelect.appendChild(this.roleSelectGroup)}s&&(s.selected=!0)}},getProject:function(e){var t=this.projectMap[e];t||(t=r.getMessage("share_invalid_project"))||(t="[Invalid Project]");return t},getRole:function(e){var t=this.roleMap[e];t||(t=r.getMessage("share_invalid_role"))||(t="[Invalid Role]");return t},updateSelectionFromPermission:function(e){this.setProject(e.param1);this.setRoles(e.param2)},getSubElement:function(e){return this.parentElement.querySelector("."+e)}};return i}));