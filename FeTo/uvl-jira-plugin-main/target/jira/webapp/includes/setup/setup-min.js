define("jira/setup/init-setup-page",["jira/ajs/select/single-select","jira/ajs/list/item-descriptor","underscore","jquery"],(function(e,a,t,n){"use strict";var i=window._gaq=window._gaq||[];return function(){var s=require("jira/setup/setup-tracker");s.insert();if(!n("body").hasClass("jira-setup-database-page")){n("#jira-setupwizard").submit((function(e){var a=n("body").hasClass("jira-setup-page-mail-notifications");if(a&&!n(this).data("intercepted")){e.preventDefault();n(this).data("intercepted",!0);setTimeout((function(){s.sendMailConfigurationEvent(function(){var e={emailProvider:"none"};if(n("#jira-setupwizard-email-notifications-disabled").is(":checked"))return e;var a,t=(a=n("select[name='serviceProvider']").val(),n.isArray(a)?a[0]:a);n.extend(e,{emailProvider:t});if("custom"===t){var i=n("#jira-setupwizard-email-notifications-smtp").is(":checked");if(i){var s=function(){var e=n("input[name='serverName']").val();return-1!==["mail","smtp","exchange"].indexOf(e)?e:""}(),r=function(){var e=n("input[name='serverName']").val().toLowerCase(),a=e.indexOf(".");e=-1!==a?e.substr(0,a):e;return-1!==["mail","smtp","exchange","mx","localhost"].indexOf(e)?e:""}();n.extend(e,{emailHostname:s,emailHostnameExt:r,emailPort:n("input[name='port']").val(),emailProtocol:function(){var e=n("select[name='protocol']").val();return n.isArray(e)?e[0]:e}()})}n.extend(e,{emailIsSMTP:i})}return e}()).always((function(){n("#jira-setupwizard").submit()}))}),0)}else if(a)return!0;n(["#jira-setupwizard-submit","#jira-setupwizard-test-connection","#jira-setupwizard-test-mailserver-connection","#jira-setupwizard-submit-instant","#jira-setupwizard-submit-classic"].join(", ")).attr("disabled","disabled");var t=n("#jira-setupwizard-server-language");t.length>0&&t.attr("disabled","disabled");n("input[name=nextStep]").val("true");!function(){"false"==n("input[name=changingLanguage]").val()&&"testconnection"==n("input[name=testingConnection]").val()||"true"==n("input[name=testingMailConnection]").val()?n("#test-connection-throbber").removeClass("hidden"):"false"!==n("input[name=changingLanguage]").val()&&"false"!==n("input[name=testingMailConnection]").val()||n("#submit-throbber").removeClass("hidden");n(".throbber-message").removeClass("hidden")}()}));n("input[name=databaseOption]").change((function(){var e="EXTERNAL"==n(this).val(),a=n("#jira-setupwizard-test-connection"),t=n("#setup-db-external");if(e){t.removeClass("hidden");a.removeClass("hidden")}else{t.addClass("hidden");a.addClass("hidden")}}));var r={ports:{},schemas:{}};r.ports.postgres72="5432";r.schemas.postgres72="public";r.ports.postgresaurora96="5432";r.schemas.postgresaurora96="public";r.ports.mysql="3306";r.schemas.mysql="";r.ports.oracle10g="1521";r.schemas.oracle10g="";r.ports.mssql="1433";r.schemas.mssql="dbo";"EXTERNAL"==n("input[name=databaseOption]:checked").val()&&n("#setup-db-external, #jira-setupwizard-test-connection").removeClass("hidden");j();C();n("select[name=databaseType]").change((function(){var e=n(this).val(),a=n("input[name='jdbcPort']"),t=n("input[name='schemaName']");a.val(r.ports[e]);t.val(r.schemas[e]);j();C()}));n("#jira-setupwizard-test-connection").click((function(){n("input[name=changingLanguage]").val("false");n("input[name=testingConnection]").val("true");n("#jira-setupwizard").submit()}));n("#jira-setupwizard-server-language").change((function(){var e=n(this).val();n("input[name=language]").val(e);n("input[name=changingLanguage]").val("true");n("#jira-setupwizard").submit()}));n("#fetchLicense").click((function(){var e=n("#jira-setupwizard").serializeArray(),a=n(this).attr("data-url");n.post(a,e,(function(){return!1}))}));var o=n("#enableAnalytics");if(1==o.length){var l=n(".analytics-yes-please"),c=n(".analytics-no-thanks"),d=function(e){return function(a){a.preventDefault();o.val(e);n(this).closest("form").submit()}};l.click(d(!0));c.click(d(!1));t.defer((function(){l.blur()}))}var u=n('input[name="analytics-enabled"]');if(u.length>0&&"true"===u.val()){var p=document.createElement("script");p.type="text/javascript";p.async=!0;p.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var m=document.getElementsByTagName("script")[0];m.parentNode.insertBefore(p,m);i.push(["_setAccount","UA-20272869-4"]);i.push(["_setDomainName","none"]);i.push(["_setDetectTitle",!1]);var v="true"===u.val()?1:0;i.push(["_trackEvent","btf.analytics",v?"enable":"disable","JIRA",0])}n("#test-connection-messages").hide();n("input[name=noemail]").change((function(){var e="false"==n(this).val(),a=n("#setup-notification-fields"),t=n("#jira-setupwizard-test-mailserver-connection");if(e){a.removeClass("hidden");t.removeClass("hidden")}else{a.addClass("hidden");t.addClass("hidden")}}));"false"==n("input[name=noemail]:checked").val()&&n("#setup-notification-fields, #jira-setupwizard-test-mailserver-connection").removeClass("hidden");n("input[name=mailservertype]").change((function(){var e=n(this).val(),a=n(".setup-fields");if("smtp"==e){a.addClass("hidden");n("#email-notifications-smtp-fields").removeClass("hidden")}else{a.addClass("hidden");n("#email-notifications-jndi-fields").removeClass("hidden")}}));var f=n("input[name=mailservertype]:checked");if("smtp"==f.val()){n(".setup-fields").addClass("hidden");n("#email-notifications-smtp-fields").removeClass("hidden")}else if("jndi"==f.val()){n(".setup-fields").addClass("hidden");n("#email-notifications-jndi-fields").removeClass("hidden")}n("#jira-setupwizard-test-mailserver-connection").click((function(){n("input[name=testingMailConnection]").val("true");n("#jira-setupwizard").attr("action","VerifySmtpServerConnection!setup.jspa").submit()}));n("#reimport").click((function(e){e.preventDefault();n("input[name=useDefaultPaths]").val("true");n("#jira-setupwizard").submit()}));n("#acknowledgeDowngradeError").click((function(e){e.preventDefault();n("#acknowledgeDowngradeError").parent().parent().fadeOut();n("input[name=downgradeAnyway]").val("true")}));var h=n("select[name=serviceProvider]");if(h.length>0){var g=new a({value:"smtps",label:"SECURE_SMTP"}),b={"gmail-smtp":{protocol:g,serverName:"smtp.gmail.com",port:"465"},"yahooplus-smtp":{protocol:g,serverName:"plus.smtp.mail.yahoo.com",port:"465"}};new e({element:h});var w=new e({element:n("select[name=protocol]")});h.change(function(e){return function(){var a=n(this).val(),t=!1,i=n("input[name=serverName]"),s=n("input[name=port]"),r=n("input[name=tlsRequired]"),o=b[a];if(o){e.setSelection(o.protocol);i.val(o.serverName);s.val(o.port)}else t=!0;e.$container.parent(".field-group").toggle(t);i.parent(".field-group").toggle(t);s.parent(".field-group").toggle(t);r&&r.parent(".field-group").toggle(t)}}(w)).change()}else n(".select").each((function(){new e({element:this})}))}function j(){var e=n("select[name=databaseType]").val();if(""!=e){n(".setup-fields").addClass("hidden");n(".db-option-"+e).removeClass("hidden")}}function C(){var e=n("select[name=databaseType]"),a=e.parent().find(".description").empty(),t=e.val();""!=t&&e.parent().find(".descriptions ."+t).clone().appendTo(a)}}}));