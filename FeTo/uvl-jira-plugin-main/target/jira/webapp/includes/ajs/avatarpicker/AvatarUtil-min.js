define("jira/ajs/avatarpicker/avatar-util",["jira/util/urls","jira/util/logger","jira/attachment/inline-attach","jquery"],(function(e,r,t,a){"use strict";var n={uploadUsingIframeRemoting:function(o,s,i){i=i||{};var l=s.val(),c=new t.Form(new t.FileInput(s,!1)),u=c.addStaticProgress(l),d=c.cloneFileInput();c.fileSelector.clear();var g=new t.Timer((function(){!this.cancelled&&u.show()}),this),f=new t.FormUpload({$input:d,url:o,params:a.extend({},i.params,{filename:l,atl_token:e.atl_token()}),scope:this,before:function(){!this.cancelled&&u.start()},success:function(e,r){e.errorMessages&&e.errorMessages.length?c.addErrorWithFileName(e.errorMessages[0],l,n.getErrorTarget(c)):i.success&&i.success(e,r)},error:function(e){r.log(e);this.cancelled||(e.indexOf("SecurityTokenMissing")>=0?c.addError(t.Text.tr("upload.xsrf.timeout",l),n.getErrorTarget(c)):c.addError(t.Text.tr("upload.error.unknown",l),n.getErrorTarget(c)))},after:function(){g.cancel();u.remove();this.cancelled||c.enable()}});u.onCancel((function(){f.abort()}));f.upload()},uploadUsingFileApi:function(r,o,s){var i,l,c,u=o[0].files[0],d=new t.Form(new t.FileInput(o,!1)),g=d.addProgress(u);s=s||{};i=new t.Timer((function(){g.show()}));(l=new t.AjaxUpload({file:u,params:a.extend({},s.params,{filename:u.name,size:u.size,atl_token:e.atl_token()}),scope:this,url:r,before:function(){o.hide();g.start()},progress:function(e){g.progress.$progress.parent().parent().show();g.update(e)},success:function(e,r){c;e.errorMessages&&e.errorMessages.length?d.addErrorWithFileName(e.errorMessages[0],u.name,n.getErrorTarget(d)):201===r&&s.success(e,r)},error:function(e,r){r<0?d.addError(e,n.getErrorTarget(d)):d.addError(t.Text.tr("upload.error.unknown",u.name),n.getErrorTarget(d));s.error&&s.error(e,r)},after:function(){i.cancel();g.finish().remove();o.val("").show()}})).upload();g.onCancel((function(){l.abort()}))},getErrorTarget:function(e){return{$element:e.$form.find(".error")}},uploadTemporaryAvatar:function(e,r,a){t.AjaxPresenter.isSupported(r)?this.uploadUsingFileApi(e,r,a):this.uploadUsingIframeRemoting(e,r,a)}};return n}));