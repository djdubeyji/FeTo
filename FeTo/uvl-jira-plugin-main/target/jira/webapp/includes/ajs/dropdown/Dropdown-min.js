define("jira/ajs/dropdown/dropdown",["jira/ajs/control","jira/ajs/layer/inline-layer","jira/ajs/layer/layer-constants","jira/ajs/layer/layer-interactions","jira/ajs/layer/hide-reasons","jira/ajs/dropdown/dropdown-constants","jira/ajs/dropdown/dropdown-list-item","jira/ajs/dropdown/dropdown-options-descriptor","underscore","jquery"],(function(t,e,i,r,o,n,s,l,a,h){"use strict";var d=t.extend({CLASS_SIGNATURE:"AJS_DROPDOWN",_createFocusHandler:function(t){t.css({outline:0}).attr("tabindex",-1);return function(e){if("Tab"===e.key){var i=t.find(":focusable");if(i.length){var r=i[0],o=i[i.length-1];if(document.activeElement===r&&e.shiftKey){o.focus();e.preventDefault()}else if(document.activeElement===o&&!e.shiftKey){r.focus();e.preventDefault()}}else e.preventDefault()}}},init:function(t){var i,r,o,n,a=this;this.options=t instanceof l?t:new l(t);i=this.options.content();r=this.options.trigger();o=this._ensureIdOf(r);(n=this.options.allProperties()).offsetTarget||(n.offsetTarget=n.trigger);n.id||(n.id=o+"_drop");this.layerController=new e(n);this.layerController._validateClickToClose=function(t){return t.target!==this.offsetTarget()[0]&&(t.target!==this.layer()[0]&&!(this.offsetTarget().has(t.target).length>0))};this.listController=this.options.listController();this.listController.bind("change:activeItem",(function(t,e){e.$element.find("a").focus()}));this.layerController.onhide((function(){a.hide()}));this.layerController.onerror((function(){h.isFunction(a.options.properties.onerror)&&a.options.properties.onerror(a)}));this.layerController.contentChange((function(){a.listController.removeAllItems();var t=a.layerController.layer().find("div > ul[role=menu] > li > ul[role=group] > li:visible:has(a)");t.length||(t=a.layerController.layer().find("div > ul > li:visible:has(a)"));t.each((function(){a.listController.addItem(new s({element:this,autoScroll:a.options.autoScroll()}))}));a.options.focusFirstItem()?a.listController.shiftFocus(0):a.listController.prepareForInput()}));this.trigger(r);this.content(i);this._applyIdToLayer()},show:function(){this.trigger().addClass(i.ACTIVE_CLASS);h(this).trigger("showLayer");this.layerController.show();if(this.content()){this._handleTabPress=this._createFocusHandler(this.content());this.content().bind("keydown",this._handleTabPress)}if(this.options.focusFirstItem())this.listController.shiftFocus(0);else{this.listController.prepareForInput();this.content()&&this.content().focus()}},hide:function(){h(this).trigger("hideLayer");this.trigger().removeClass(i.ACTIVE_CLASS);this.layerController.hide();this.content()&&this.content().unbind("keydown",this._handleTabPress);this.listController.trigger("blur")},toggle:function(){if(!this._toggling){this._toggling=!0;this.layerController.isVisible()?this.hide():this.show();setTimeout(function(){this._toggling=!1}.bind(this),0)}},content:function(t){if(!t)return this.layerController.content();this.options.content()&&this._unassignEvents("content",this.options.content());this._assignEvents("content",this.options.content());this.layerController.content(t)},trigger:function(t){if(!t)return this.options.trigger();this.options.trigger()&&this._unassignEvents("trigger",this.options.trigger());this.options.trigger(h(t));this.layerController.offsetTarget()||this.layerController.offsetTarget(this.options.trigger());this._assignEvents("trigger",this.options.trigger())},_ensureIdOf:function(t){var e=t.attr("id");a.isEmpty(e)&&(e=t.attr("id",a.uniqueId(this.CLASS_SIGNATURE+"__")));return e},_applyIdToLayer:function(){var t=this._ensureIdOf(this.trigger()),i=this.layerController.layer().attr("id")||t+"_drop";this.layerController.layer().attr({id:i,"aria-hidden":!0});this.trigger().attr({"aria-controls":i,"aria-haspopup":!0,"aria-expanded":!1});this.layerController.bind(e.EVENTS.show,function(){this.trigger().attr("aria-expanded",!0)}.bind(this));this.layerController.bind(e.EVENTS.hide,function(t,e,i){this.trigger().attr("aria-expanded",!1);this.trigger().one("beforeBlurInput",(function(t){t.preventDefault()}));i===o.escPressed&&this.trigger().focus()}.bind(this))},_events:{trigger:{"aui:keydown":function(t){if("Return"===t.key||"Spacebar"===t.key){t.preventDefault();this.toggle()}if("Down"===t.key&&!this.layerController.isVisible()){t.preventDefault();this.show()}},click:function(t){t.preventDefault();this.options.stopTriggerClickPropagation()&&t.stopPropagation();this.toggle()}},content:{keydown:function(t){if("Escape"===t.key&&this.options.stopEscapePropagation()){t.stopPropagation();this.hide();this.trigger().focus()}}}}});h.extend(d,n);r.preventDialogHide(d);r.hideBeforeDialogShown(d);return d}));AJS.namespace("AJS.DropDown",null,require("jira/ajs/dropdown/dropdown"));AJS.namespace("AJS.Dropdown",null,require("jira/ajs/dropdown/dropdown"));