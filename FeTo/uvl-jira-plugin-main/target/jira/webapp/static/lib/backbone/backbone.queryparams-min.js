/*! THIS FILE HAS BEEN MODIFIED BY ATLASSIAN, SEE https://github.com/jhudson8/backbone-query-parameters/pull/63/files */
define("jira/backbone-queryparams",["underscore"],(function(t){return function(e){var r=/^\?(.*)/,n=/\((.*?)\)/g,a=/(\(\?)?:\w+/g,i=/\*\w+/g,o=/[\-{}\[\]+?.,\\\^$|#\s]/g,s=/^([^\?]*)/,c=/[\:\*]([^\:\?\/]+)/g,u=/^[#\/]|\s+$/g,l=/\/$/;e.Router.arrayValueSplit="|";var h=function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var r=this.root.replace(l,""),n=this.location.search;t.indexOf(r)||(t=t.substr(r.length));n&&(t+=n)}else t=this.getHash();return t.replace(u,"")};function p(e,r,n){t.each(Array.prototype.slice.call(arguments,2),(function(t){Object.defineProperty(r,t,{get:function(){return e[t]},set:function(r){e[t]=r}})}))}p.isSupported=function(){try{Object.defineProperty({},"x",{});return!0}catch(t){return!1}}();var f=e.History.prototype.start,m=e.History.prototype.loadUrl;t.extend(e.History.prototype,{getFragment:h,getQueryParameters:function(e,n){var a=(e=h.apply(this,arguments)).replace(s,""),i=a.match(r);if(i){a=i[1];var o={};g(a,(function(e,r){r=r.replace(/\+/g,"%20");r=decodeURIComponent(r);o[e]?t.isString(o[e])?o[e]=[o[e],r]:o[e].push(r):o[e]=r}));return o}return{}},start:function(){if(p.isSupported){!function(t){var e=t.location,r={};p(e,r,"assign","ancestorOrigins","origin","hash","search","pathname","port","hostname","host","protocol","href","reload");r.replace=function(){e.replace(t.root+"#"+t.fragment)};r.unPatch=function(){return t.location=e};t.location=r}(this);!function(t){var e=t.history,r={};p(e,r,"length","state","back","forward","go","pushState");r.replaceState=function(r,n,a){a=t.root+t.fragment;return e.replaceState(r,n,a)};r.unPatch=function(){t.history=e};t.history=r}(this)}try{return f.apply(this,arguments)}finally{this.location.unPatch&&this.location.unPatch();this.history.unPatch&&this.history.unPatch()}},loadUrl:function(){this.location&&this.location.unPatch&&this.location.unPatch();this.history&&this.history.unPatch&&this.history.unPatch();return m.apply(this,arguments)}});t.extend(e.Router.prototype,{initialize:function(t){this.encodedSplatParts=t&&t.encodedSplatParts},getFragment:h,_routeToRegExp:function(e){var r=i.exec(e)||{index:-1},s=a.exec(e)||{index:-1},u=e.match(c)||[];e=e.replace(o,"\\$&").replace(n,"(?:$1)?").replace(a,(function(t,e){return e?t:"([^\\/\\?]+)"})).replace(i,"([^??]*?)");e+="(\\?.*)?";var l=new RegExp("^"+e+"$");r.index>=0&&(l.splatMatch=s>=0?r.index-s.index:-1);l.paramNames=t.map(u,(function(t){return t.substring(1)}));l.namedParameters=this.namedParameters;return l},_extractParameters:function(n,a){var i=n.exec(a).slice(1),o={};i.length>0&&t.isUndefined(i[i.length-1])&&i.splice(i.length-1,1);var s=i.length&&i[i.length-1]&&i[i.length-1].match(r);if(s){var c=s[1],u=Object.create(null);if(c){var l=this;g(c,(function(t,e){l._setParamValue(t,e,u)}))}i[i.length-1]=u;t.extend(o,u)}var h=i.length;if(n.splatMatch&&this.encodedSplatParts){if(n.splatMatch<0)return i;h-=1}for(var p=0;p<h;p++)if(t.isString(i[p])){i[p]=decodeURIComponent(i[p]);n.paramNames&&n.paramNames.length>=p-1&&(o[n.paramNames[p]]=i[p])}return e.Router.namedParameters||n.namedParameters?[o]:i},_setParamValue:function(t,e,r){for(var n=(t=t.replace("[]","")).split("."),a=r,i=0;i<n.length;i++){var o=n[i];i===n.length-1?a[o]=this._decodeParamValue(e,a[o]):a=a[o]=a[o]||Object.create(null)}},_decodeParamValue:function(r,n){r=r.replace(/\+/g,"%20");var a=e.Router.arrayValueSplit;if(a&&r.indexOf(a)>=0){for(var i=r.split(a),o=i.length-1;o>=0;o--)i[o]?i[o]=decodeURIComponent(i[o]):i.splice(o,1);return i}r=decodeURIComponent(r);if(n){if(t.isArray(n)){n.push(r);return n}return[n,r]}return r},toFragment:function(e,r){if(r){t.isString(r)||(r=this._toQueryString(r));r&&(e+="?"+r)}return e},_toQueryString:function(r,n){var a=e.Router.arrayValueSplit;function i(t){return String(t).replace(a,encodeURIComponent(a))}if(!r)return"";n=n||"";var o="";for(var s in r){var c=r[s];if(t.isString(c)||t.isNumber(c)||t.isBoolean(c)||t.isDate(c)){c=this._toQueryParam(c);(t.isBoolean(c)||t.isNumber(c)||t.isString(c)||c)&&(o+=(o?"&":"")+this._toQueryParamName(s,n)+"="+i(encodeURIComponent(c)))}else if(t.isArray(c)){for(var u="",l=0;l<c.length;l++){var h=this._toQueryParam(c[l]);(t.isBoolean(h)||null!==h)&&(u+=a+i(h))}u&&(o+=(o?"&":"")+this._toQueryParamName(s,n)+"="+u)}else{var p=this._toQueryString(c,this._toQueryParamName(s,n,!0));p&&(o+=(o?"&":"")+p)}}return o},_toQueryParamName:function(t,e,r){return e+t+(r?".":"")},_toQueryParam:function(e){return t.isNull(e)||t.isUndefined(e)?null:e}});function g(e,r){var n=e.split("&");t.each(n,(function(t){var e=t.split("=");r(e.shift(),e.join("="))}))}}}));