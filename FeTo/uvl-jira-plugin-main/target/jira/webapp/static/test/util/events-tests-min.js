AJS.test.require("jira.webresources:jira-events",(function(){"use strict";var e=require("jira/util/events"),n=require("jquery"),t="foo";module("JIRA Events",{setup:function(){this.sandbox=sinon.sandbox.create();this.loggerErrorStub=this.sandbox.stub(require("jira/util/logger"),"error")},teardown:function(){this.sandbox.restore();e.unbind(t)}});test("Can trigger events",(function(){var r=this.sandbox.spy();e.bind(t,r);e.trigger(t,["bar"]);equal(r.callCount,1);ok(n.inArray(r.getCall(0).args,"bar"))}));test("Triggers jQuery events",(function(){var r=this.sandbox.spy();e.bind(t,r);e.trigger(t);ok(r.getCall(0).args[0]instanceof n.Event)}));test("Bind adds an event",(function(){var n=this.sandbox.spy();e.bind(t,n);e.trigger(t);equal(n.callCount,1,"called when bound")}));test("Unbind removes the event",(function(){var n=this.sandbox.spy();e.bind(t,n);e.trigger(t);equal(n.callCount,1,"called when bound");e.unbind(t,n);e.trigger(t);equal(n.callCount,1,"should not be called any more")}));test("Binds events to the document",(function(){var r=this.sandbox.spy();n(document).bind(t,r);e.bind(t,r);e.trigger(t);equal(r.callCount,2)}));test("Isolates handlers (catches JS error)",(function(){var n=this.sandbox.stub().throws("TypeError"),r=this.sandbox.spy();e.bind(t,n);e.bind(t,r);e.trigger(t);sinon.assert.calledOnce(n);sinon.assert.calledOnce(r);sinon.assert.calledOnce(this.loggerErrorStub);sinon.assert.calledWithExactly(this.loggerErrorStub,"An error occurred in one of the callback passed to jira/util/events",sinon.match.defined)}));test("Wrapping preserves params",(function(){var r=this.sandbox.spy();e.bind(t,r);e.trigger(t,["bar",123]);sinon.assert.calledOnce(r);sinon.assert.calledWithExactly(r,sinon.match.instanceOf(n.Event),"bar",123)}));test("Wrapping preserves the context",(function(){e.bind(t,(function(){equal(this,document)}));e.trigger(t)}))}));