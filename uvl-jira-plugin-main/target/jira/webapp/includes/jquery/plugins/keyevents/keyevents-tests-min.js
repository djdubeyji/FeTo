AJS.test.require(["jira.webresources:key-commands"],(function(){var e=require("jquery");module("Normalised Key Events",{teardown:function(){e(document).unbind("aui:keydown aui:keypress aui:keyup")}});var n={Backspace:8,Tab:9,Return:13,Shift:16,Control:17,Alt:18,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Del:46},t=r("keydown"),o=r("keypress"),a=r("keyup");(e.browser.mozilla||e.browser.opera)&&(t=function(t,o){var a=n[t]||t.charCodeAt(0);e(o||document).trigger({type:"keydown",keyCode:a,which:a});e(o||document).trigger({type:"keypress",keyCode:a,which:0})});test("Character keys are identified by character",(function(){var n;e(document).bind("aui:keypress",(function(e){n=e.key}));o("A");equal(n,"A",'Key code 65 yields event.key == "A" for "aui:keypress" event');o("a");equal(n,"a",'Key code 97 yields event.key == "a" for "aui:keypress" event');o("ß");equal(n,"ß",'Key code 223 yields event.key == "ß" for "aui:keypress" event')}));test("Non-character keys are identified by name",(function(){var o;e(document).bind("aui:keydown aui:keyup",(function(e){o=e.key}));for(var r in n){t(r);equal(o,r,"Key code "+n[r]+' yields event.key == "'+r+'" for "aui:keydown" event');a(r);equal(o,r,"Key code "+n[r]+' yields event.key == "'+r+'" for "aui:keyup" event')}}));test('"aui:keydown" and "aui:keyup" events do not fire for unrecognised keys',(function(){var e=new i("aui:keydown"),n=new i("aui:keyup");t("A");a("A");equal(e.valueOf(),0,'"aui:keydown" event is not fired when event.which == 65');equal(n.valueOf(),0,'"aui:keyup"   event is not fired when event.which == 65')}));test('"aui:keypress" event does not fire for non-character keys',(function(){var e=new i("aui:keypress");o("\0");equal(e.valueOf(),0,'"aui:keypress" event is not fired when event.which == 0')}));e.browser.msie&&test("Modifier keys are not fired repeatedly",(function(){var e=new i("aui:keydown");t("Shift");t("Shift");equal(e.valueOf(),1,"SHIFT key is only fired once");t("Control");t("Control");equal(e.valueOf(),2,"CTRL key is only fired once");t("Alt");t("Alt");equal(e.valueOf(),3,"ALT key is only fired once")}));test("Default action is prevented with event.preventDefault() on normalised event",(function(){var n={keydown:!1,keypress:!1,keyup:!1};e(document).bind("aui:keydown aui:keypress aui:keyup",(function(e){e.preventDefault()}));e(document).bind("keydown keypress keyup",(function(e){n[e.type]=e.isDefaultPrevented()}));t("Control");o("z");a("Control");equal(n.keydown,!0,'event.preventDefault() of "aui:keydown"  event prevents default action of related "keydown"  event');equal(n.keypress,!0,'event.preventDefault() of "aui:keypress" event prevents default action of related "keypress" event');equal(n.keyup,!0,'event.preventDefault() of "aui:keyup"    event prevents default action of related "keyup"    event')}));function r(t){return function(o,a){var r="number"==typeof o?o:n[o]||o.charCodeAt(0);e(a||document).trigger({type:t,keyCode:r,which:r})}}function i(n){var t=0;this.valueOf=function(){return t};e(document).bind(n,(function(){t++}))}}));