AJS.test.require(["jira.webresources:edit-project-details"],(function(){"use strict";var e=require("jquery"),i=require("jira/project/project-edit-key"),t="HSP5";module("JIRA.Project.ProjectEditKey",{setup:function(){this.$field=e('<div><input class="text" type="text" name="key" id="project-edit-key" value="'+t+'" maxlength="10"><input type="hidden" id="edit-project-original-key" name="originalKey" value="'+t+'"><input type="hidden" id="edit-project-key-edited" name="keyEdited" value="false"></div>');e("#qunit-fixture").append(this.$field);this.createUnitUnderTest=function(){return new i(this.$field,{flagShowDelay:0})}},teardown:function(){e("#aui-flag-container").remove();e("#projectTypeKey-suggestions").parent().remove()}});function a(){var i=e("#aui-flag-container").find(".aui-flag");return i.length>0&&"open"===i.attr("open")}test("Initialise with different key, will show warning flag",(function(){this.$field.find("#edit-project-original-key").val("HSP");this.createUnitUnderTest();ok(a(),"When having different project-key values during initialisation, shall show the warning flag")}));test("Initialise with original key, does not show any flags",(function(){this.createUnitUnderTest();ok(!a(),"No flag when the project-key value is the original one")}));test("Change the key in the dialogue will pop the flag",(function(){var e=this.createUnitUnderTest();this.$field.find("#project-edit-key").val("lll");e.checkModified();ok(a(),"Flag showing after changing the project key");equal(this.$field.find("#edit-project-key-edited").val(),"true","mark the project-key as edited")}));test("Change the key to its original value will remove the flag ",(function(){var e=this.createUnitUnderTest();this.$field.find("#project-edit-key").val("lll");e.checkModified();ok(a(),"Flag showing after changing the project key");this.$field.find("#project-edit-key").val(t);e.checkModified();ok(!a(),"No flag when the project-key value is the original one");equal(this.$field.find("#edit-project-key-edited").val(),"false","mark the project-key as edited")}));test("Closing the flag will not show up again even when matching the original key",(function(){var i=this.createUnitUnderTest();this.$field.find("#project-edit-key").val("lll");i.checkModified();ok(a(),"Flag showing after changing the project key");e("#aui-flag-container").find(".aui-close-button").click();this.$field.find("#project-edit-key").val("ORIGINAL_KEY");i.checkModified();ok(!a(),"No flag when the project-key value is the original one");this.$field.find("#project-edit-key").val("HS");i.checkModified();ok(!a(),"No flag when it has been dismissed by user")}));test("Change the key in the dialogue will pop the flag",(function(){var i=this.createUnitUnderTest();this.$field.find("#project-edit-key").val("lll");i.checkModified();ok(a(),"Flag showing after changing the project key");equal(this.$field.find("#edit-project-key-edited").val(),"true","mark the project-key as edited");e("#aui-flag-container").find(".aui-flag a.cancel").click();i.checkModified();equal(this.$field.find("#edit-project-key-edited").val(),"false","now the project-key is not marked as modified after flag-reset-value");equal(this.$field.find("#project-edit-key").val(),t,"the project key has the original value after flag-reset-value");ok(!a(),"No flag when the project-key value is the original one")}))}));