AJS.test.require(["jira.webresources:shifter"],(function(){"use strict";var e,t=require("jira/shifter/shifter-analytics"),l=require("jira/util/data/meta"),a=require("jira/analytics"),i=require("underscore"),n=sinon.assert,s=sinon.match;function o(e){return{name:"jira.dotdialog.selection",data:i.extend({lang:"en"},e)}}var c={setup:function(){this.sandbox=sinon.sandbox.create();this.sandbox.stub(l,"get").returns("en");e=this.sandbox.stub(a,"send")},teardown:function(){this.sandbox.restore()}};module("ShifterAnalytics#show",c);test("should trigger an event",(function(){t.show();n.calledOnce(e);n.calledWith(e,{name:"jira.dotdialog.show",data:void 0})}));module("ShifterAnalytics#selection",c);test("shouldn't trigger if there are not enough parameters",(function(){t.selection();t.selection("label");t.selection("label","value");t.selection("label","value","group-id");n.calledOnce(e);n.calledWith(e,s.has("name","jira.dotdialog.selection"))}));test("should hash labels that are potentially user-entered",(function(){t.selection("label","value","group-id");n.calledOnce(e);n.calledWith(e,o({group:"group-id",selected:"102727412"}))}));test("shouldn't hash values in white-listed groups",(function(){i.each(t.selection.privacyPolicySafeGroups,(function(l){t.selection("label","value",l);n.calledWith(e,o({group:l,selected:"label"}))}));n.calledTwice(e)}));test("shouldn't hash white-listed values",(function(){i.each(t.selection.privacyPolicySafeLabels,(function(l){t.selection(l,"value","group-id");n.calledWith(e,o({group:"group-id",selected:l}))}));n.callCount(e,8)}));test('should use values and not labels for system fields in "edit-fields" group',(function(){t.selection("label","value","edit-fields");n.calledOnce(e);n.calledWith(e,o({group:"edit-fields",selected:"value"}))}));test('should hash custom fields in "edit-fields" group',(function(){t.selection("label","customfield_123","edit-fields");n.calledOnce(e);n.calledWith(e,o({group:"edit-fields",selected:"102727412"}))}));test("Should extract language from the locale",(function(){l.get.returns("te_ST");t.selection("label","value","group");n.calledOnce(e);n.calledWith(e,{name:"jira.dotdialog.selection",data:{lang:"te",group:"group",selected:"102727412"}})}));test("Should use default language if something is wrong with the locale",(function(){l.get.returns("wrong");t.selection("label","value","group");n.calledOnce(e);n.calledWith(e,{name:"jira.dotdialog.selection",data:{lang:"en",group:"group",selected:"102727412"}})}));test("Should use default language if there is no locale",(function(){l.get.returns(void 0);t.selection("label","value","group");n.calledOnce(e);n.calledWith(e,{name:"jira.dotdialog.selection",data:{lang:"en",group:"group",selected:"102727412"}})}))}));