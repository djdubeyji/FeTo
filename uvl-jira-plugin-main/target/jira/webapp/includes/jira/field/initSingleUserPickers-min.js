define("jira/field/init-single-user-pickers",["jquery","wrm/context-path","aui/params","jira/ajs/select/single-select","jira/util/events/reasons","jira/util/events/types","jira/util/events","jira/field/user-picker-util","jira/util/formatter","jira/field/create-user-picker-popup-trigger","jira/ajs/list/item-descriptor"],(function(e,t,r,i,a,n,o,s,p,u,c){"use strict";var d=t();function l(e){return r.projectKeys?r.projectKeys:e.data("project-key")}function f(t){e(".js-default-user-picker",t).each((function(){var t=e(this);if(!t.data("aui-ss")){var r,a=(r=t.attr("name"))&&-1!==r.indexOf("customfield_");AJS.populateParameters();var n=!0===t.data("use-new-endpoint")&&Boolean(l(t)),o=t.data("inputValue");t.data("has-popup-picker")&&t.next(".popup-trigger").on("click",u.createUserPickerPopupTrigger({urlBase:d,formName:t.data("form-name")||t.closest("form").attr("name"),fieldName:t.prop("name"),fieldConfigId:t.data("field-config-id"),projectIds:t.data("project-ids")?t.data("project-ids").split(",").filter((function(e){return e})):void 0,triggerEvent:"userpicker:onPopUpSelection"}));new i({element:t,submitInputVal:!0,hasAddonIcon:!!t.data("has-popup-picker"),showDropdownButton:!!t.data("show-dropdown-button"),errorMessage:p.I18n.getText("user.picker.invalid.user","'{0}'"),iconType:"rounded",ajaxOptions:{url:s.getUrl(a,n,t.prop("name")),data:{showAvatar:!n||void 0,fieldName:a?t.prop("name"):void 0,fieldConfigId:a?t.data("field-config-id"):void 0,projectId:a?t.data("project-ids").split(",").filter((function(e){return e})):void 0,maxResults:n?100:void 0,projectKeys:n?l(t):void 0},formatResponse:n?s.formatResponseWithoutHTML:s.formatResponse},inputText:o,ariaLabel:p.I18n.getText("user.picker.select.user"),events:{element:{"userpicker:onPopUpSelection":function(t,r,i,a){e.ajax({url:d+"/rest/api/2/user?username="+a,type:"GET",contentType:"application/json",success:function(e){i.setSelection(new c({value:a,label:e.displayName,icon:e.avatarUrls["24x24"]}),!0)},error:function(e){return console.error(e)}})}}}})}}))}o.bind(n.NEW_CONTENT_ADDED,(function(e,t,r){r!==a.panelRefreshed&&f(t)}));return f}));